<meta charset="utf-8" /><script>
    //
    // This method Gets URL Parameters (GUP)
    //
    function gup( name )
    {
      var regexS = "[\\?&]"+name+"=([^&#]*)";
      var regex = new RegExp( regexS );
      var tmpURL = window.location.href;
      var results = regex.exec( tmpURL );
      if( results == null )
        return "";
      else
        return results[1];
    }
    function decode(strToDecode)
    {
      var encoded = strToDecode;
      return unescape(encoded.replace(/\+/g,  " "));
    }

    window.onload = function() {
        if (!window.jQuery) {
            // jQuery is not loaded
            alert("Warning: it seems that jquery is disabled on your browser.  This HIT might not work properly without javascript and jquery code enabled (if you have extensions that block jquery or an old browser version, this may prevent the dynamic elements of the HIT from functioning).  Please ensure that you have jquery enabled by temporarily disabling extensions that interfere with jquery and/or trying a different browser version.");
        }
        //checkIfWorkerExists();
        layout();
    }
    </script>
    <link crossorigin="anonymous" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" rel="stylesheet" /><script
      src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
      crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script><!--For autocomplete--><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.devbridge-autocomplete/1.4.7/jquery.autocomplete.js"></script><!--link ref="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-autocomplete/1.0.7/jquery.auto-complete.css"--><!--script src="https://homes.cs.washington.edu/~msap/debug/neural-detox/emoji.json" ></script>

    <script src="https://homes.cs.washington.edu/~msap/debug/neural-detox/emojiv2.js"></script-->
    <section class="container" id="preInstruction" style="margin-bottom:0px; padding: 0px 10px; color:#333333;">
    <div class="card">
    <div class="card-header" style="color: #fff;background-color: #337ab7;border-color: #337ab7;"><strong>Short instructions &amp; Consent Form</strong></div>

    <div class="card-body row">
    <div class="col-7">
    <p><em><strong>Summary</strong></em>: This research study aims to <strong>understand how toxicity, hate, and social biases appear in language</strong>. You will <strong>read a potentially toxic or biased statement, two different contexts</strong>, and <strong>answer related questions</strong>. This should take 1-5 minutes.</p>

    <p><em>Background:</em> Here at CMU, we are passionate about understanding how potentially toxic or disrespectful language or stereotypes can be used against certain demographics/groups of people (e.g. racism, sexism, etc.). Although there is no direct benefit to you for participating, we very much appreciate your help in identifying and explaining such language/stereotypes, since this is something computational AI systems have no clue about.</p>

    <p><em>Content warning</em>: Due to the nature of this study, you will encounter biased, offensive, or upsetting content. While it&#39;s crucial for us to annotate them, we do not endorse any of the stereotypes or offensive/immoral/rude material. If you have strong negative reactions to some of the content, please reach out <a href="https://www.crisistextline.org/">to Crisis Text Line</a>.</p>

    <p><em>Participation</em>: You must be at least 18 years old. Participation is voluntary. You may discontinue participation at any time during the research activity. You may print a copy of this consent form for your records.</p>
    </div>

    <div class="col-5" style="font-size: .9em;">
    <p><em>Data collection &amp; sharing</em>: We will not ask you for your name, and the data collected in this study will be made unidentifiable to the best of our extent. We will securely store the data on our servers and only share with qualified researchers (e.g., who want to further the study of hate speech detection). If you later decide that you do not want your responses included in this study, please email so we can exclude your work.</p>

    <p><em>Contact</em>: If you have any questions about this study, you should feel free to ask them by contacting us (via the MTurk interface or via email at maartensap@cmu.edu). If you have questions later, desire additional information, or wish to withdraw your participation please contact Maarten Sap via e-mail in accordance with the contact information listed above. If you have questions pertaining to your rights as a research participant; or to report concerns to this study, you should contact the Office of Research Integrity and Compliance at Carnegie Mellon University, referencing study number STUDY2022_00000331. Email: <a href="mailto:irb-review@andrew.cmu.edu">irb-review@andrew.cmu.edu</a>. Phone: 412-268-1901 or 412-268-5460.</p>
    </div>

    <div class="col-12">
    <div class="alert alert-info" role="alert">Note: More HITs would be available in the future. Meanwhile, we would love to hear your feedback on how to make the task easier to understand!</div>

    <hr />
    <h6>Consent to the task to participate:</h6>

    <div class="form-check"><label class="form-check-label"><input class="form-check-input" id="consent" name="consent" onclick="toggleConsent(this.checked)" type="checkbox" /> Checking this box indicates that you have read and understood the information above, are 18 years or older, and agree to participate in our study. </label></div>
    &nbsp;

    <div class="alert alert-warning" id="consentMessage" style="max-width: 400px;margin: auto;">You must check the box to continue the task! If you do not consent, feel free to return the HIT.</div>

    <div style="display: none;"><input id="clickedConsentTime" name="clickedConsentTime" placeholder="" type="text" /> <input id="clickedSubmitTime" name="clickedSubmitTime" placeholder="" type="text" /></div>
    </div>
    </div>
    </div>
    </section>
    <!--END OF HIT HEADER; START OF HIT BODY-->

    <section class="container" id="actualTask" style="color:#333333; display: none;">
    <fieldset>
    <div class="card" style="display: block;">
    <div class="card-header">
    <h4 class="card-title" style="">Full Instructions &nbsp; &nbsp; <a aria-controls="instructions" aria-expanded="false" data-toggle="collapse" href="#instructions" role="button" style="color:#0080ff;text-decoration: underline;"> (Expand/Collapse) </a></h4>
    </div>

    <div class="collapse show" id="instructions" style="margin: 2em;">
    <div class="row"><!--div class="col-12 mb-4">
                <p style="font-size: 1em; text-align: left">
                  You will read a message taken from somewhere on the internet, the potential listener and speaker identity and the situation where the message happened. And then, you will rate some explanations of the message. Please answer all questions from an US cultural perspective; try to think about what would be prevalent opinions on these.
               </p>

              </div-->
    <div class="col-12">
    <h5>Detailed instructions</h5>

    <p style="margin-bottom: .5rem;"><span class="numbering">1)</span> Carefully <strong>read the statement or message and its two different contexts</strong>, and with a US sociocultural perspective in mind.</p>

    <p style="margin-bottom: .5rem;"><span class="numbering">2)</span> <strong>Account for the difference of contexts (situational context, speaker and listener identities)</strong> when interpreting the statement. <!--em>Read the message carefully. </em>
                    When you interpret the message, make sure you take into account the speaker and listener's
                    identities as well as the situation.--></p>

    <p style="margin-bottom: .5rem;"><span class="numbering">3)</span> <strong>Rate</strong> the contexts and <strong>answer</strong> how the contexts may influence the <strong>offensiveness</strong> of the statement.
      <!-- <ul>
        <li><em class="context">rate the contexts</em>: rate whether the contexts are plausible given the statement.</li>
        <li><em class="context">which context makes the statement more offensive/less harmless</em>: </li>
        <li><em class="context">the statement is offensive under which context</em>: </li>
        <li><em class="context">the statement is harmless under which context</em>: </li>
      </ul> -->

    <br><br>
    <b>‚ùóNotes</b> <a aria-controls="instructions" aria-expanded="false" data-toggle="collapse" href="#notes" role="button" style="color:#0080ff;"> (Expand/Collapse) </a>:

    <div class="collapse show" id="notes">
    <ul>
        <li>
            <strong>Rare situational context</strong>: Sometimes some situational context may seem to rarely happen in real life. For example, a statement "all jews are money grabbing, hook-nosed monsters" has the situational context "a discussion about the Holocaust in a world history classroom". Though it is rarely the case someone would say things like this in a history classroom, it could happen and makes the statement extremely hateful. Since we would like to include these scenarios in our dataset, we consider these rare situational context as somewhat plausible.
        </li>
    </ul>
    </div>
    </div>
    </div>

    <div class="row">
    <div class="col-12">
    <p class="mt-4"><em><strong style="color: #e60000;">Content Warning</strong></em>: posts were found on the (uncensored) internet; while it&#39;s crucial for us to annotate them, we do not endorse any of the stereotypes or offensive/immoral/rude material. You may find some of the content upsetting. <em>If you have concerns, questions, please reach out to the study team. If you have more immediate strong negative reactions to some of the content</em>, please reach out <a href="https://www.crisistextline.org/">to Crisis Text Line</a>.</p>
    </div>
    </div>

    <div class="row justify-content-center" style="margin-top: 20px;">
    <div class="col-11" id="table-container">
    <h5>Examples <small><a aria-controls="collapseExample" aria-expanded="false" class="collapsed" data-toggle="collapse" href=".extra-exs" onclick="expExamples();"> [-] less examples </a></small></h5>

    <div class="d-flex flex-column" style="margin-top: 20px; margin-bottom: 20px; border-radius: 3px; box-shadow: 1.5px 1.5px 3px 3px rgba(0, 0, 1, 0.2);">
      <table class="table table-striped" id="inputTable">
        <tbody>
          <tr>
            <td colspan="2"> <em class="context">Statement</em>: it's not a big deal, just let it go &nbsp;</td>
          </tr>
          <tr>
            <td style="width: 35%;">
              <em class="context">Scenario A</em></br>
              <em class="context_small">Situational context</em>: a friend broke a cup in their friends' house</br>
              <em class="context_small">Speaker identity</em>: the house owner </br>
              <em class="context_small">Listener identity</em>: the friend who broke the cup
            </td>
            <td style="width: 35%;">
              <em class="context">Scenario B</em></br>
              <em class="context_small">Situational context</em>: a conversation between two co-workers about sexual harassment in the workplace</br>
              <em class="context_small">Speaker identity</em>: male co-worker</br>
              <em class="context_small">Listener identity</em>: female co-worker
            </td>
            <td><em class="context">Answer</em></td>
          </tr>
          <tr>
            <td class="cb-gray" style="width: 70%;" colspan="2">Does the <em class="context">scenario A</em> seem plausible/realistic?</td>
            <td>plausible (since the house owner is comforting their friend)</td>
          </tr>
          <tr>
            <td class="cb-gray" style="width: 70%;" colspan="2">Does the <em class="context">scenario B</em> seem plausible/realistic?&nbsp;</td>
            <td>plausible (since the statement often happens when someone ignores other's pain)</td>
          </tr>
          <tr>
            <td class="cb-gray" style="width: 70%;" colspan="2">Which <em class="context">scenario</em> makes the statment seem more <span class="cb-purple">problematic</span>?</td>
            <td>Scenario B (the male co-worker downplays the harm of sexual harassment; microaggression)</td>
          </tr>
          <tr>
            <td class="cb-gray" style="width: 70%;" colspan="2">Which <em class="context">scenario</em> makes the statement <span class="cb-green">harmless</span>?&nbsp;</td>
            <td>Scenario A (the statement serves to comfort the listener)</td>
          </tr>
          <tr>
            <td class="cb-gray" style="width: 70%;" colspan="2">Which <em class="context">scenario</em> makes the statement <span class="cb-brown">offensive</span>?</td>
            <td>Scenario B (the statement implies that sexual harassment to women is tolerable)</td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- <div class="collapse show extra-exs">
  <div class="d-flex flex-column" style="margin-top: 20px; margin-bottom: 20px; border-radius: 3px; box-shadow: 1.5px 1.5px 3px 3px rgba(0, 0, 1, 0.2);">
    <table class="table table-striped" id="inputTable">
      <tbody>
        <tr>
          <td colspan="2"> <em class="context">Statement</em>: any time a trans person asks me to address them by a gendered pronoun i sneer at them and call them male &nbsp;</td>
        </tr>
        <tr>
          <td>
            <em class="context">Scenario A</em></br>
            <em class="context_small">Situational context</em>: overheard in a cafe</br>
            <em class="context_small">Speaker identity</em>: younger cisgender male</br>
            <em class="context_small">Listener identity</em>: nobody, just muttered to himself
          </td>
          <td>
            <em class="context">Scenario B</em></br>
            <em class="context_small">Situational context</em>: heated argument between two people on an online platform</br>
            <em class="context_small">Speaker identity</em>: transphobic person</br>
            <em class="context_small">Listener identity</em>: transgender person
          </td>
          <td><em class="context">Answer</em></td>
        </tr>
        <tr>
          <td class="cb-gray" style="width: 35%;"><span class="cb-teal">Speaker intent A</span></br> The speaker is trying to express his opinion about trans people</td>
          <td class="cb-gray" style="width: 35%;"><span class="cb-teal">Speaker intent B</span></br> The speaker is trying to express their disdain for transgender people and their identities</td>
          <td>different, due to contexts (the intents here are aligned with the speaker identity and the situational contexts)</td>
        </tr>
        <tr>
          <td class="cb-gray" style="width: 35%;"><span class="cb-purple">Target (group) A</span></br> trans people&nbsp;</td>
          <td class="cb-gray" style="width: 35%;"><span class="cb-purple">Target (group) B</span></br> transgender people&nbsp;</td>
          <td>similar, should be similar (the contexts here should not change the target group)</td>
        </tr>
        <tr>
          <td class="cb-gray" style="width: 35%;"><span class="cb-gold">Power dynamic A</span></br> power differential between cisgender speaker and transgender listener</td>
          <td class="cb-gray" style="width: 35%;"><span class="cb-gold">Power dynamic B</span></br> gender power differential between speaker and listener, as well as transphobia power differential between the two</td>
          <td>different, due to contexts</td>
        </tr>
        <tr>
          <td class="cb-gray" style="width: 35%;"><span class="cb-orange">Implication A</span></br> implies that trans people are not valid or worthy of respect, and that they should be addressed by the gender assigned at birth&nbsp;</td>
          <td class="cb-gray" style="width: 35%;"><span class="cb-orange">Implication B</span></br> implies that transgender people are not valid, and that their chosen pronouns are not valid either&nbsp;</td>
          <td>similar, should be similar (the implications are basically the same, which questions the validity of transgender people)</td>
        </tr>
        <tr>
          <td class="cb-gray" style="width: 35%;"><span class="cb-green">Target emotional reaction A</span></br> trans people could feel angry, invalidated, and hurt by the statement</td>
          <td class="cb-gray" style="width: 35%;"><span class="cb-green">Target emotional reaction B</span></br> anger, disappointment, frustration at the invalidation of their identity by the speaker</td>
          <td>similar, should be similar</td>
        </tr>
        <tr>
          <td class="cb-gray" style="width: 35%;"><span class="cb-brown">Effect on target A</span></br> might lead them to avoid places like this cafe, be more cautious around cisgender people, or feel less safe in public spaces</td>
          <td class="cb-gray" style="width: 35%;"><span class="cb-brown">Effect on target B</span></br> might want to avoid the online platform, might feel less safe coming out or using their preferred pronouns in public spaces</td>
          <td>different, due to contexts (the effects are different since the situational contexts are different. )</td>
        </tr>
        <tr>
          <td class="cb-gray" style="width: 35%;"><span class="cb-pink">Type of offensiveness A</span></br> offensive and hate speech</td>
          <td class="cb-gray" style="width: 35%;"><span class="cb-pink">Type of offensiveness B</span></br> offensive</td>
          <td>different, not due to contexts (The type of offensiveness A seems more severe than the type of offensivness B, however, it should be the other way around since the intention of the speaker B is directly attacking transgender people. )</td>
        </tr>
      </tbody>
    </table>
  </div>
    </div> -->
<a aria-controls="collapseExample" aria-expanded="false" class="collapsed" data-toggle="collapse" href=".extra-exs" onclick="expExamples();">[-] less examples </a></div>
</div>
</div>
</div>
&nbsp;

    <div class="container" id="allQuestions">
    <div class="row justify-content-center">
    <div class="col-12 mt-5 mb-2">
    <h4 style="font-style: italic;">Read the <em class="context">statement</em>, two <em class="context">scenarios</em> in the table and answer the questions below</h4>
    </div>

    <table class="table table-striped" id="inputTable">
      <tbody>
        <tr>
          <td colspan="2"> <em class="context">Statement</em>: ${statement} &nbsp;</td>
        </tr>
        <tr>
          <td>
            <em class="context">Scenario A</em></br>
            <em class="context_small">Situational context</em>: ${situationalContext1}</br>
            <em class="context_small">Speaker identity</em>: ${speaker1}</br>
            <em class="context_small">Listener identity</em>: ${listener1}
          </td>
          <td>
            <em class="context">Scenario B</em></br>
            <em class="context_small">Situational context</em>: ${situationalContext2}</br>
            <em class="context_small">Speaker identity</em>: ${speaker2}</br>
            <em class="context_small">Listener identity</em>: ${listener2}
        </tr>
      </tbody>
    </table>

    <div class="col-12 mt-5 mb-2">
        <h4 style="font-style: italic;">1. Rate the <span class="cb-blue">scenarios</span></h4>
      </div>
      <div class="col-12 mt-2 mb-2">
        <h5 style="font-style: italic;">a. Does the <span class="cb-blue">scenario A</span> seem plausible/realistic?</h5>
      </div>
      <table class="table table-striped" id="inputTable">
        <tr>
          <td style="width: 100%;">
            <label>very implausible/unrealistic <input class="agreement" type="radio" for="scenarioARating" name="scenarioARating" value=0 required></label>
            <label><input class="agreement" type="radio" for="scenarioARating" name="scenarioARating" value=1> </label>
            <label><input class="agreement" type="radio" for="scenarioARating" name="scenarioARating" value=2> </label>
            <label><input class="agreement" type="radio" for="scenarioARating" name="scenarioARating" value=3> very plausible/realistic</label></td>
          <!-- <td>Suggest a better situational context:<br>
          <input type="text" placeholder="..." name="hsituationSuggestion"></td> -->
        </tr>
      </table>
      <div class="col-12 mt-2 mb-2">
        <h5 style="font-style: italic;">b. Does the <span class="cb-blue">scenario B</span> seem plausible/realistic?</h5>
      </div>
      <table class="table table-striped" id="inputTable">
        <tr>
          <td style="width: 100%;">
            <label>very implausible/unrealistic <input class="agreement" type="radio" for="scenarioBRating" name="scenarioBRating" value=0 required></label>
            <label><input class="agreement" type="radio" for="scenarioBRating" name="scenarioBRating" value=1> </label>
            <label><input class="agreement" type="radio" for="scenarioBRating" name="scenarioBRating" value=2> </label>
            <label><input class="agreement" type="radio" for="scenarioBRating" name="scenarioBRating" value=3> very plausible/realistic</label></td>
        </tr>
      </table>

      <div class="col-12 mt-3 mb-2">
        <h4 style="font-style: italic;">2. Which <span class="cb-blue">scenario</span> makes the statement seem more <span class="cb-purple">problematic</span>?</h4>
      </div>
      <table class="table table-striped" id="inputTable">
        <tr>
          <td style="width: 65%;">
            <label><input class="likelihood" for="moreOff" name="moreOff" type="radio" value="0" /> Scenario A</label><br />
            <label><input class="likelihood" for="moreOff" name="moreOff" type="radio" value="1" /> Scenario B</label><br/>
          </td>
        </tr>
      </table>

      <div class="col-12 mt-3 mb-2">
        <h4 style="font-style: italic;">3. Which <span class="cb-blue">scenario</span> makes the statement <span class="cb-green">harmless</span>?</h4>
      </div>
      <table class="table table-striped" id="inputTable">
        <tr>
            <td style="width: 65%;">
                <label><input class="likelihood" for="harmlessOne" name="harmlessOne" type="radio" value="0" /> Scenario A</label><br />
                <label><input class="likelihood" for="harmlessOne" name="harmlessOne" type="radio" value="1" /> Scenario B</label><br/>
                <label><input class="likelihood" for="harmlessOne" name="harmlessOne" type="radio" value="-1" /> None, the statment is offensive under the two scenarios</label><br/>
                <label><input class="likelihood" for="harmlessOne" name="harmlessOne" type="radio" value="-1" /> Both, the statment is harmless under the two scenarios</label><br/>
            </td>
        </tr>
      </table>

      <div class="col-12 mt-3 mb-2">
        <h4 style="font-style: italic;">4. Which <span class="cb-blue">scenario</span> makes the statement <span class="cb-brown">offensive</span> ?</h4>
      </div>
      <table class="table table-striped" id="inputTable">
        <tr>
            <td style="width: 65%;">
                <label><input class="likelihood" for="offensiveOne" name="offensiveOne" type="radio" value="0" /> Scenario A</label><br />
                <label><input class="likelihood" for="offensiveOne" name="offensiveOne" type="radio" value="1" /> Scenario B</label><br/>
                <label><input class="likelihood" for="offensiveOne" name="offensiveOne" type="radio" value="-1" /> None, the statment is harmless under the two scenarios</label><br/>
                <label><input class="likelihood" for="offensiveOne" name="offensiveOne" type="radio" value="-1" /> Both, the statment is offensive under the two scenarios</label><br/>
            </td>
        </tr>
      </table>
    </div>
    </div>

    <div class="row justify-content-center">
    <div class="col-9" id="commentSection" style="display: inline-block;text-align: center;">
    <p style="font-size:10pt;margin-top: 50px;">Optional Feedback: Thanks for filling out the questions above! If something about the hit was unclear, please either leave a comment in the box below! We would like to make this HIT easier for future workers, so we really appreciate feedback though it is optional.<br />
    If you have concerns or questions, please email us!</p>
    <textarea name="commentbox" rows="2" style="margin-left:10px;margin-top:10px;width: 95%;"></textarea><br />
    &nbsp;
    <center>
    <div class="alert alert-danger" id="submitAlert" style="display: none;">Whoops you missed some questions!<br />
    Note: if the submit button is disabled and you&#39;re confident this is an error, please screenshot your answers and the console output (Ctrl+Shift+J or Cmd+Shift+J).</div>
    <input class="btn btn-primary" id="submitButton" type="submit" value="Submit Hit!" /></center>
    </div>
    </div>
    </fieldset>
    </section>
    <script>
      var targ, btngroup, event, selectedText, aspectDiv, workerInfo;
      var attentionChecks = ["first","second", "third", "fourth", "fifth"];
      $(function () {
      $('[data-toggle="tooltip"]').tooltip()
      })
      function scrollToAnchor(aid){
        console.log(aid);
        var aTag = $(aid);
        $('html,body').animate({scrollTop: aTag.offset().top},'slow');
      }
      $("label.btn-checkbox>input[type='checkbox']").each(function(ix,e){
        var value = $(e).parent().prop("innerText").trim();
        e.value = value == "" ? "_other_" : value;
      });

      /* Make the textbox (suggestion) required for the value in a certain range */
      $(".likelihood").on("click",function(e){
        event = e;
        var num = e.target.name.slice(-1)
        var dim = e.target.name.replace(/Rating\d/,"")
        var val = parseInt($("input[name='"+dim+"Rating"+num+"']:checked").prop("value"));
        console.log(dim,val);
        if (val < 2 && val > -1)
          $("input[name='"+dim+"Suggestion"+num+"']").prop("required","true");
        else
          $("input[name='"+dim+"Suggestion"+num+"']").prop("required","");
      })
      $(".btn-checkbox").on("click",function(e){
        targ = e.target;
        aspectDiv = $(targ).closest(".card-body").find(".aspects");

        /* Highlight button if checkbox is clicked */
        if(e.target.tagName == "INPUT"){
          if (targ.checked)
            $(targ).parent().addClass("active");
          else
            $(targ).parent().removeClass("active");
        }

        /* Make textboxes required if any checkbox is checked */
        if ($(targ).closest(".btn-group-vertical").find("input:checkbox:checked").length > 0) {
          aspectDiv.show();
          aspectDiv.find("input[type='text']").each(function (i,e){
            if (i>1)
              return;
            $(e).prop("required","true");
          });
        } else {
          aspectDiv.hide();
          aspectDiv.find("input[type='text']").each(function (i,e){
            $(e).prop("value","");
            if (i>1)
              return;
            $(e).prop("required","");
          });
        }
        alertMinorityQs("yes");
      });
      $('.collapse-checkbox').on('hide.bs.collapse', function (e) {
      /* If any checkboxes are checked, this makes sure the buttons don't disappear */
      btngroup = e.target;
      if ($(btngroup).find("input:checkbox:checked").length > 0)
        e.preventDefault();
      })
      $(".othercheckbox").on("click",function(e){
        var checked = $(e.target).prop("checked")
        $(e.target).next().prop("disabled",!checked);
        $(e.target).next().prop("required",checked? "true": "");
      });
      $("input[type='text']").prop("pattern",".{0}|.{3,}").prop("title","Minimum 3 characters");


      $("button.btn-link").on("click",function(e){
        //Not sure why I need this, but otherwise accordion submits immediately
        e.preventDefault();
        event = e;
        //console.log(e.target);
      });
      $("#submitButton").on("click",function(e){
        var val = validate();
        if (!val) {
          e.preventDefault();
          event = e;
          $("#submitAlert").show();
          setTimeout(function(){
            $("#submitAlert").hide(300);
          }, 10000);
        } else {
          // sendWorkerInfo();
          $("#clickedSubmitTime").val((new Date()).getTime());
          console.log("Submitted");
        }
      });
      function layout(){
        $("#postText").each(function (i,e){
          ee = e;
          //e.innerText = renderEmoji(e.innerText);
        });
        var attnIx = Math.floor(Math.random()*attentionChecks.length);
        console.log("Attention check "+(attnIx+1)+" "+attentionChecks[attnIx])
        $("#attentionCheckInstr").text(attentionChecks[attnIx]);
        $("#attentionCheckCorrect").val(attnIx+1);
      }
      function getURLParams(){
        var search = location.search;
        if (location.hostname === "homes.cs.washington.edu"){
          search = "?workerId=A1TW2IIFTWJIB2&hitId=Testing";
          console.log(search)
        }

        search = search.substring(1);
        if (search == ""){
          console.log("No search params "+location.href);
          return {};
        }
        var params = JSON.parse('{"' + search.replace(/&/g, '","').replace(/=/g,'":"') + '"}', function(key, value) { return key===""?value:decodeURIComponent(value) });

        params["HITId"] = params["hitId"];
        params["HITType"] = "contextSBF-validation";
        console.log(params);
        return params;
      }
      function toggleConsent(checked){
        if (checked){
          $("#actualTask").show();
          $("#consentMessage").hide();
          $("#clickedConsentTime").val((new Date()).getTime());
          scrollToAnchor("#actualTask");
        } else {
          $("#actualTask").hide();
          $("#consentMessage").show();
        }
      }
      function toggleDontUnderstandAck(checked){
        if(checked)
          $("#dontUnderstandAck").show()
        else
          $("#dontUnderstandAck").hide()
      }
      function prepSQLparamsCheck(urlParams){
        var out="";
        out += "tableName="+"workerDemographics";
        out += "&workerId="+urlParams["workerId"];
        out += "&HITType="+urlParams["HITType"];
        out += "&assignmentId="+urlParams["assignmentId"];
        out += "&HITId="+urlParams["HITId"];
        return out;
      }
      function prepSQLparamsStore(){
        var out="";
        out += "tableName="+"workerDemographics";
        out += "&gender="+$("#annotatorGender").val();
        out += "&age="+$("#annotatorAge").val();
        out += "&race="+$("#annotatorRace").val();
        out += "&politics="+$('input[name="annotatorPolitics"]:checked').val();
        out += "&otherMinority="+encodeURIComponent($("#annotatorMinority").val());


        return out;
      }

      function validate(){

        valid = $("input:invalid").length == 0;
        console.log("########## VALIDATING #########\nvalid? "+valid);
        $("input:invalid").each(function (i,e){
          console.log(e);
        });
        return valid;
      }
      function alertMinorityQs(val){
        if (val == "yes" && $(".btn-checkbox>input:checked").length == 0) {
          //$("#dummyMinority").prop("required","true");
          $("#alertQminority").show();
        } else {
          //$("#dummyMinority").prop("required","");
          $("#alertQminority").hide();
        }
      }
      var rows;
      function expRows(){
        rows = $("tr.extra-rows");
        $("a:contains('examples')").each(function(ix,link){
          if (rows.hasClass("show"))
            link.innerText = "[+] more examples";
          else
            link.innerText = "[-] less examples";
          console.log(link);
        })
      }

      var divs;
      function expExamples(){
        divs = $("div.extra-exs");
        $("a:contains('examples')").each(function(ix,link){
          if (divs.hasClass("show"))
            link.innerText = "[+] more examples";
          else
            link.innerText = "[-] less examples";
          console.log(link);
        })
      }

    </script>
    <style type="text/css">#examples-table {
      /*border-style: none solid none solid;*/
      border-width: 1px;
      border-color: #dee2e6;
      border-radius: 5px;
      padding: 2px;
    }
    #examples-table td {
      border-top: #dee2e6;
      border-bottom: #dee2e6;
      border-left: #ffffff;
      border-right: #ffffff;
      border-style: solid;
      border-width: 1px;
      padding: 2px;
    }

    #inputTable {
      border:0px solid #b3adad;
      border-collapse:collapse;
      padding:5px;
    }

    #inputTable td {
      border:0px solid #b3adad;
      padding:5px;
    }

    .card-header-accordion{
      padding: 0px 10px;
    }
    body, td, .btn {
      /*font-size:0.85rem;*/
    }
    label {
      margin-bottom: 0px;
    }
    .story-excerpt {
      margin: 40px auto;
      min-width: 500px;
      border:2px #333333;
      background-color: #f2f2f2;
      border-style: solid;
      padding-right:10px;
      padding-left:10px;
      display:table;
      border-radius:15px;
    }
    .story-excerpt-example {
      border: 1px solid #666666;
      background-color: #f2f2f2;
      border-radius: 3px;
      padding: 3px;
      display: inline-block;
      margin: 10px;
    }
    span.numbering {
      font-weight: bold;
      margin-right: .5em;
    }
    #introQuestion>div>label>input,
    #intentQuestion>div>label>input {
      vertical-align: middle;
    }
    .prefilled-message{
      font-style: italic;
    }

    #detailed-instructions>p {
      margin-bottom: 0px;
    }
    span.instrQuestion {
      background-color: #f2f2f2;
      font-style: italic;
      font-size: .9rem;
      margin: 5px 0 3px -15px;
      padding: 0 .3rem 0 .3rem;
      display: inline-block;
    }
    span.instrDescription {
      font-size: .9rem;
      margin-left: -15px;
    }
    label > input[type='text'] {
      width: 90%;
    }
    input[type='text'] {
      width: 300px;
    }
    input[type='text'].opt-target {
      background-color: #f8f8f8;
    }

    input[type="text"]:invalid {
      color: #a94442;
      background-color: #f2dede;
    }

    textarea#postText {
      margin-left: 20px;
      font-size: 12pt;
      width: auto;
      background-color: transparent;
      overflow: auto;
      resize: none;
    }

    .btn-checkbox, .btn-checkbox-two {
      .btn-light;
      color: black;
      text-align: left;
      margin: 0px;
      background-color: #e9ecef;
      border-color: #d1d4d7;
    }

    .btn-checkbox.active,
    .btn-checkbox:active,
    .btn-checkbox:hover {
      background-color: #babcbf;
      border-color: #8b8d8f;
    }

    .btn-checkbox-two.active,
    .btn-checkbox-two:active,
    .btn-checkbox-two:hover {
      background-color: #babcbf;
      border-color: #8b8d8f;
    }

    .btn-group-vertical {
      max-width: 400px;
      /*margin-right: 10px;*/
    }
    #introQuestion,
    #minorityQuestions,
    #demogQuestions {
      margin-bottom: 10px;
      margin-top: 10px;
    }
    .autocomplete-suggestions {
      border: 1px solid #999;
      background: #FFF;
      overflow: auto;
    }
    #dummyMinority {
      /*opacity:0;*/
      width: 0px;
    }
    .autocomplete-suggestion { padding: 2px 5px; white-space: nowrap; overflow: hidden; }
    .autocomplete-selected { background: #F0F0F0; }
    .autocomplete-suggestions strong { font-weight: normal; color: #3399FF; }
    .autocomplete-group { padding: 2px 5px; }
    .autocomplete-group strong { display: block; border-bottom: 1px solid #000; }

    input[type='checkbox'] {
      /* All <input> elements that are immediate children of a class="btn-checkbox" */
      margin-right: 5px;
    }
    ul {
      padding-left: 30px;
      margin-bottom: 10px;
    }
    fieldset {
      padding: 10px;
      background:#fbfbfb;
      border-radius:5px;
      margin-bottom:5px;
    }
    .lickert>label{
        font-style: italic;
      }

    .cb-blue {
        color: #006cd8;
        font-weight: bold;
    }

    .cb-teal {
      color: #1b9e77;
      font-weight: bold;

    }
    .cb-orange {
      color: #d95f02;
      font-weight: bold;
    }
    .cb-purple {
      color: #7570b3;
      font-weight: bold;
    }
    .cb-pink {
      color: #e7298a;
      font-weight: bold;
    }
    .cb-green {
      color: #66a61e;
      font-weight: bold;
    }
    .cb-gold {
      color: #e6ab02;
      font-weight: bold;
    }
    .cb-brown{
      color: #a6761d;
      font-weight: bold;
    }
    .cb-gray{
      color: #3f3f3f;
    }
    .cb-bg-teal {
      background-color: #1b9e77
    }
    .cb-bg-orange {
      background-color: #d95f02
    }
    .cb-bg-purple {
      background-color: #7570b3
    }
    .cb-bg-pink {
      background-color: #e7298a
    }
    .cb-bg-green {
      background-color: #66a61e
    }
    .cb-bg-gold {
      background-color: #e6ab02
    }
    .cb-bg-brown{
      background-color: #a6761d
    }
    .context {
      font-style: italic;
      font-weight: bold;
      color: #006cd8;
    }
    .context_small{
      font-style: italic;
      font-weight: normal;
      color: #006cd8;
    }
    todo {
      font-style: italic;
      font-weight: bold;
      color: #e60000;
      background-color: black;
    }

    .possibleAnswer {
      margin-left: 2em;
    }
    .badTd {
      background: #FF8C8C;
    }
    .goodTd{
      background: #14C38E;
    }

    /*********************************/
    .imessage {
      background-color: #fff;
      border: 1px solid #e5e5ea;
      border-radius: 0.25rem;
      display: flex;
      flex-direction: column;
      /*font-family: "SanFrancisco";*/
      /*font-size: 1.25rem;*/
      margin: 0 auto 1rem;
      max-width: 600px;
      padding: 0.5rem 1.5rem;
    }

    .imessage p {
      border-radius: 1.15rem;
      line-height: 1.25;
      max-width: 75%;
      padding: 0.5rem .875rem;
      position: relative;
      word-wrap: break-word;
    }

    .imessage p::before,
    .imessage p::after {
      bottom: -0.1rem;
      content: "";
      height: 1rem;
      position: absolute;
    }

    p.from-me {
      align-self: flex-end;
      background-color: #248bf5;
      color: #fff;
    }

    p.from-me::before {
      border-bottom-left-radius: 0.8rem 0.7rem;
      border-right: 1rem solid #248bf5;
      right: -0.35rem;
      transform: translate(0, -0.1rem);
    }

    p.from-me::after {
      background-color: #fff;
      border-bottom-left-radius: 0.5rem;
      right: -40px;
      transform:translate(-30px, -2px);
      width: 10px;
    }

    p[class^="from-"] {
      margin: 0.5rem 0;
      width: fit-content;
    }

    p.from-me ~ p.from-me {
      margin: 0.25rem 0 0;
    }

    p.from-me ~ p.from-me:not(:last-child) {
      margin: 0.25rem 0 0;
    }

    p.from-me ~ p.from-me:last-child {
      margin-bottom: 0.5rem;
    }

    p.from-them {
      align-items: flex-start;
      background-color: #e5e5ea;
      color: #000;
    }

    p.from-them:before {
      border-bottom-right-radius: 0.8rem 0.7rem;
      border-left: 1rem solid #e5e5ea;
      left: -0.35rem;
      transform: translate(0, -0.1rem);
    }

    p.from-them::after {
      background-color: #fff;
      border-bottom-right-radius: 0.5rem;
      left: 20px;
      transform: translate(-30px, -2px);
      width: 10px;
    }

    p[class^="from-"].emoji {
      background: none;
      font-size: 2.5rem;
    }

    p[class^="from-"].emoji::before {
      content: none;
    }

    .no-tail::before {
      display: none;
    }

    .margin-b_none {
      margin-bottom: 0 !important;
    }

    .margin-b_one {
      margin-bottom: 1rem !important;
    }

    .margin-t_one {
      margin-top: 1rem !important;
    }
    .speaker {
      border-radius: .2em;
      background-color: #ACCFF2;/*#D5E7F9;*/
      padding: .5em;
    }
    .listener {
      border-radius: .2em;
      background-color: #CAE1F7;
      padding: .5em;
    }
    .situation {
      border-radius: .2em;
      background-color: #DDECFA;
      padding: .5em;
    }
    </style>
