<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
</head>
<body>
<script>
//
// This method Gets URL Parameters (GUP)
//
function gup( name )
{
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var tmpURL = window.location.href;
  var results = regex.exec( tmpURL );
  if( results == null )
    return "";
  else
    return results[1];
}
function decode(strToDecode)
{
  var encoded = strToDecode;
  return unescape(encoded.replace(/\+/g,  " "));
}

window.onload = function() {
    if (!window.jQuery) {  
        // jQuery is not loaded
        alert("Warning: it seems that jquery is disabled on your browser.  This HIT might not work properly without javascript and jquery code enabled (if you have extensions that block jquery or an old browser version, this may prevent the dynamic elements of the HIT from functioning).  Please ensure that you have jquery enabled by temporarily disabling extensions that interfere with jquery and/or trying a different browser version."); 
    }
    //checkIfWorkerExists();
    layout();
}
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script
  src="https://code.jquery.com/jquery-3.5.1.js"
  integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
  crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<!--For autocomplete-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.devbridge-autocomplete/1.4.7/jquery.autocomplete.js"></script>
<!--link ref="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-autocomplete/1.0.7/jquery.auto-complete.css"-->

<!--script src="https://homes.cs.washington.edu/~msap/debug/neural-detox/emoji.json" ></script>

<script src="https://homes.cs.washington.edu/~msap/debug/neural-detox/emojiv2.js"></script-->


<section class="container" id="preInstruction" style="margin-bottom:0px; padding: 0px 10px; color:#333333;">
   <div class="card">
      <div class="card-header" style="color: #fff;background-color: #337ab7;border-color: #337ab7;"><strong>Short instructions &amp; Consent Form</strong></div>
      <div class="card-body row">
         <div class="col-7">
            <p><em><strong>Summary</strong></em>: This research study aims to <strong>understand how toxicity, hate, and social biases appear in language</strong>. You will <strong>read a potentially toxic or biased statement and some explanations</strong> of what it means, and <strong>rate the explanations</strong>. This should take 5-10 minutes.
            </p>
            <p>
               <em>Background:</em> Here at CMU, we are passionate about  about understanding how potentially toxic or disrespectful language or stereotypes can be used against certain demographics/groups of people (e.g. racism, sexism, etc.).
               Although there is no direct benefit to you for participating, we very much appreciate your help in identifying and explaining such language/stereotypes, since this is something computational AI systems have no clue about. 
            </p>
            <p><em>Content warning</em>: 
               Due to the nature of this study, you will encounter biased, offensive, or upsetting content.
               While it's crucial for us to annotate them, we do not endorse any of the stereotypes or offensive/immoral/rude material.
               If you have strong negative reactions to some of the content</em>, please reach out <a href="https://www.crisistextline.org/">to Crisis Text Line</a>.
            </p>
            <p>
               <em>Participation</em>: You must be at least 18 years old. Participation is voluntary. You may discontinue participation at any time during the research activity. You may print a copy of this consent form for your records. 
            </p>
         </div>
         <div class="col-5" style="font-size: .9em;">
            <p>
               <em>Data collection &amp; sharing</em>: 
               We will not ask you for your name, and the data collected in this study will be made unidentifiable to the best of our extent.
               We will securely store the data on our servers and only share with qualified researchers (e.g., who want to further the study of hate speech detection).
               If you later decide that you do not want your responses included in this study, please email so we can exclude your work.
            </p>
            <p>
               <em>Contact</em>: If you have any questions about this study, you should feel free to ask them by contacting us (via the MTurk interface or via email at maartensap@cmu.edu). If you have questions later, desire additional information, or wish to withdraw your participation please contact Maarten Sap via e-mail in accordance with the contact information listed above.  
               If you have questions pertaining to your rights as a research participant; or to report concerns to this study, you should contact the Office of Research integrity and Compliance at Carnegie Mellon University, referencing study number STUDY2022_00000331. Email: <a href="mailto:irb-review@andrew.cmu.edu">irb-review@andrew.cmu.edu</a>. Phone: 412-268-1901 or 412-268-5460. 
            </p>

         </div>
         <div class="col-12">
            <div class="alert alert-info" role="alert">
              Note: this is a <strong>pilot task</strong>. More HITs would be available in the future. 
              Meanwhile, we would love to hear your feedback on how to make the task easier to understand! 
            </div>
            <hr>
            <h6>Consent to the task to participate:</h6>
            <div class="form-check">
               <label class="form-check-label">
               <input class="form-check-input" type="checkbox" id="consent" name="consent" onclick="toggleConsent(this.checked)">
               Checking this box indicates that you have read and understood the information above, are 18 years or older, and agree to participate in our study.
               </label>
            </div>
            <br>
            <div class="alert alert-warning" id="consentMessage" style="max-width: 400px;margin: auto;">
               You must check the box to continue the task! If you do not consent, feel free to return the HIT.
            </div>
            <div style="display: none;">
               <input name="clickedConsentTime" id="clickedConsentTime" type="text" placeholder="">
               <input name="clickedSubmitTime" id="clickedSubmitTime" type="text" placeholder="">
            </div>
         </div>
      </div>
   </div>
</section>
    

<!--END OF HIT HEADER; START OF HIT BODY-->
<section class="container" style="color:#333333; display: none;" id="actualTask">
  <fieldset>
    <div class="card" style="display: block;">
      <div class="card-header">
        <h4 class="card-title" style=""> 
          Full Instructions &nbsp; &nbsp;
          <a data-toggle="collapse" href="#instructions" role="button" aria-expanded="false" aria-controls="instructions" style="color:#0080ff;text-decoration: underline;">
          (Expand/Collapse)
          </a> 
        </h4>
      </div>
      <div id="instructions" class="collapse show" style="margin: 2em;">
        <div class="row">
          <!--div class="col-12 mb-4">
            <p style="font-size: 1em; text-align: left">
              You will read a message taken from somewhere on the internet, the potential listener and speaker identity and the situation where the message happened. And then, you will rate some explanations of the message. Please answer all questions from an US cultural perspective; try to think about what would be prevalent opinions on these.
           </p>
           
          </div-->

          <div class="col-12">
            <h5>Detailed instructions</h5>
            <p style="margin-bottom: .5rem;">
              <span class="numbering">1)</span> 
                Carefully <strong>read the statement or message and its context</strong>, and with a US sociocultural perspective in mind.
            </p>
            
            <p style="margin-bottom: .5rem;">
              <span class="numbering">2)</span> 
                <strong>Account for the context (situation, speaker and listener identities)</strong> when interpreting the statement.
            </p>

            <p style="margin-bottom: .5rem;">
              <span class="numbering">3)</span> <strong>Rate the context</strong> about the statement or message. 
                <strong>If disagree, please suggest a better 
                context</strong> using the text box beside the radio buttons. 
            </p>
            <br>
        </div>
        <div class="row">
          <div class="col-12">
          </div>
        </div>

        <div class="row justify-content-center" style="margin-top: 20px;">
          <div class="col-11" id="table-container">
            <h5>Examples <small><a href=".extra-exs" class="collapsed" data-toggle="collapse" aria-expanded="false" aria-controls="collapseExample" onclick="expExamples();">
              [-] less examples
            </a></small></h5>
            <div class="d-flex flex-column" style="margin-top: 20px; margin-bottom: 20px; border-radius: 3px; box-shadow: 1.5px 1.5px 3px 3px rgba(0, 0, 1, 0.2);">
              <div class="row justify-content-center" style="background-color: ghostwhite; border: 1px solid darkgrey; border-radius: 3px; width: 80%; margin-left: auto; margin-right: auto; margin-top: 20px;">
                <div class="col-12 text-center" style="margin: 1em 0;">
                  <div class="situation">
                  <em style="font-size: 18; color: #006cd8;  font-weight: bold;">Situation</em>: <span id="speechContextInput">high school cafeteria chatting about a girl with learning disability</span>
                  </div>
                </div>
                <div class="col-3">
                  <div class="speaker">
                    <em style="font-size: 15; color: #006cd8;  font-weight: bold;">Speaker identity</em>: <span id="speakerInput" >student with learning disability</span>
                    </div>
                </div>
                
                <div class="col-6 imessage">
                  <p class="from-them">
                    why are you friends with her? she is retarded!
                  </p>
                </div>
                <div class="col-3">
                <div class="listener">
                  <em style="font-size: 15; color: #006cd8;  font-weight: bold;">Listener identity</em>: <span id="listenerInput">other students</span>
                  </div>
                </div>
              </div>
              <div class="mt-3" id="table-container"></div> 
              <div class="table-responsive", style="margin-left: 20px; margin-right: 20px; width: 96%">
              <table class="table table-hover" id="examples-table">
                <thead class="thead-light">
                  <th scope="col" style="width: 10%;">Context</th>
                  <th scope="col" style="width: 30%;"></th>
                  <th scope="col" style="width: 20%;">Rating</th>
                  <th scope="col" style="width: 40%;">Suggest a better alternative</th>
                </thead>
                <tbody>
                  <tr>
                    <td class="cb-teal">Situation</td>
                    <td>high school cafeteria chatting about a girl with learning disability</td>
                    <td>plausible</td>
                    <td></td>
                  </tr>
                  <tr>
                    <td class="cb-purple">Speaker identity</td>
                    <td>student with learning disability</td>
                    <td>implausible</td>
                    <td>student without learning disability</td>
                  </tr>
                  <tr>
                    <td class="cb-orange">Listener identity</td>
                    <td>other students</td>
                    <td>plausible</td>
                    <td></td>
                  </tr>
                  <!-- <tr>
                    <td class="cb-gold">Triple</td>
                    <td>Replaced with my suggestions (if any), the current triple (situation, speaker, listener) helps me better understand the statement.</td>
                    <td>very/somewhat agree</td>
                    <td></td>
                  </tr> -->
                </tbody>
              </table>

              </div>
            </div>

            <div class="collapse show extra-exs">
                <div class="d-flex flex-column" style="margin-top: 20px; margin-bottom: 20px; border-radius: 3px; box-shadow: 1.5px 1.5px 3px 3px rgba(0, 0, 1, 0.2);">
                  <div class="row justify-content-center" style="background-color: ghostwhite; border: 1px solid darkgrey; border-radius: 3px; width: 80%; margin-left: auto; margin-right: auto; margin-top: 20px;">
                    <div class="col-12 text-center" style="margin: 1em 0;">
                            <div class="situation">
                            <em style="font-size: 18; color: #006cd8;  font-weight: bold;">Situation</em>: <span id="speechContextInput">political argument between two friends</span>
                            </div>
                          </div>
                          <div class="col-3">
                            <div class="speaker">
                              <em style="font-size: 15; color: #006cd8;  font-weight: bold;">Speaker identity</em>: <span id="speakerInput" >black person</span>
                              </div>
                          </div>
                          
                          <div class="col-6 imessage">
                            <p class="from-them">
                              Rap music and its artists are whats holding african-america back			
                            </p>
                          </div>
                          <div class="col-3">
                          <div class="listener">
                            <em style="font-size: 15; color: #006cd8;  font-weight: bold;">Listener identity</em>: <span id="listenerInput">black person</span>
                            </div>
                          </div>
                        </div>
                        <div class="mt-3" id="table-container"></div> 
                        <div class="table-responsive", style="margin-left: 20px; margin-right: 20px; width: 96%">
                        <table class="table table-hover" id="examples-table">
                          <thead class="thead-light">
                            <th scope="col" style="width: 10%;">Context</th>
                            <th scope="col" style="width: 30%;"></th>
                            <th scope="col" style="width: 20%;">Rating</th>
                            <th scope="col" style="width: 40%;">Suggest a better alternative</th>
                          </thead>
                          <tbody>
                            <tr>
                              <td class="cb-teal">Situation</td>
                              <td>political argument between two friends</td>
                              <td>plausible</td>
                              <td></td>
                            </tr>
                            <tr>
                              <td class="cb-purple">Speaker identity</td>
                              <td>black person</td>
                              <td>plausible</td>
                              <td></td>
                            </tr>
                            <tr>
                              <td class="cb-orange">Listener identity</td>
                              <td>black person</td>
                              <td>plausible</td>
                              <td></td>
                            </tr>
                            <!-- <tr>
                              <td class="cb-gold">Triple</td>
                              <td>Replaced with my suggestions, the current triple (situation, speaker, listener) helps me better understand the statement.</td>
                              <td>very/somewhat disagree</td>
                              <td></td>
                            </tr> -->
                          </tbody>
                        </table>
                        </div>
                </div>
              </div>

            <div class="collapse show extra-exs">
                <div class="d-flex flex-column" style="margin-top: 20px; margin-bottom: 20px; border-radius: 3px; box-shadow: 1.5px 1.5px 3px 3px rgba(0, 0, 1, 0.2);">
                  <div class="row justify-content-center" style="background-color: ghostwhite; border: 1px solid darkgrey; border-radius: 3px; width: 80%; margin-left: auto; margin-right: auto; margin-top: 20px;">
                    <div class="col-12 text-center" style="margin: 1em 0;">
                            <div class="situation">
                            <em style="font-size: 18; color: #006cd8;  font-weight: bold;">Situation</em>: <span id="speechContextInput">conversation between two people just met in a bar</span>
                            </div>
                          </div>
                          <div class="col-3">
                            <div class="speaker">
                              <em style="font-size: 15; color: #006cd8;  font-weight: bold;">Speaker identity</em>: <span id="speakerInput" >white lesbian</span>
                              </div>
                          </div>
                          
                          <div class="col-6 imessage">
                            <p class="from-them">
                                You’re so much less man-hating than I expected a [women’s college] lesbian to be!			
                            </p>
                          </div>
                          <div class="col-3">
                          <div class="listener">
                            <em style="font-size: 15; color: #006cd8;  font-weight: bold;">Listener identity</em>: <span id="listenerInput">white man</span>
                            </div>
                          </div>
                        </div>
                        <div class="mt-3" id="table-container"></div> 
                        <div class="table-responsive", style="margin-left: 20px; margin-right: 20px; width: 96%">
                        <table class="table table-hover" id="examples-table">
                          <thead class="thead-light">
                            <th scope="col" style="width: 10%;">Context</th>
                            <th scope="col" style="width: 30%;"></th>
                            <th scope="col" style="width: 20%;">Rating</th>
                            <th scope="col" style="width: 40%;">Suggest a better alternative</th>
                          </thead>
                          <tbody>
                            <tr>
                              <td class="cb-teal">Situation</td>
                              <td>conversation between two people just met in a bar</td>
                              <td>plausible</td>
                              <td></td>
                            </tr>
                            <tr>
                              <td class="cb-purple">Speaker identity</td>
                              <td>white lesbian</td>
                              <td>implausible</td>
                              <td>white man</td>
                            </tr>
                            <tr>
                              <td class="cb-orange">Listener identity</td>
                              <td>white man</td>
                              <td>implausible</td>
                              <td>white lesbian</td>
                            </tr>
                            <!-- <tr>
                              <td class="cb-gold">Triple</td>
                              <td>Replaced with my suggestions, the current triple (situation, speaker, listener) helps me understand the statement.</td>
                              <td>very/somewhat agree</td>
                              <td></td>
                            </tr> -->
                          </tbody>
                        </table>
                        </div>
                </div>
              </div>
            <a href=".extra-exs" class="collapsed" data-toggle="collapse" aria-expanded="false" aria-controls="collapseExample" onclick="expExamples();">
              [-] less examples
            </a>
          </div>
        </div>   
      </div>
      </div>

    </div>
    
    <br>
    <br>
    <div class="container" id="allQuestions">
      <div class="row justify-content-center">
        <div class="row justify-content-center" style="background-color: ghostwhite; border: 1px solid darkgrey; border-radius: 3px; width: 80%; margin-left: auto; margin-right: auto;">
          <div class="col-12 text-center" style="margin: 1em 0;">
            <div class="situation">
            <em style="font-size: 18; color: #006cd8;  font-weight: bold;">Situation</em>: <span id="speechContextInput">${speechContext}</span>
            </div>
          </div>
          <div class="col-3">
          <div class="speaker">
            <em style="font-size: 15; color: #006cd8;  font-weight: bold;">Speaker identity</em>: <span id="speakerInput">${speakerIdentity}</span>
            </div>
          </div>
          
          <div class="col-6 imessage">
            <p class="from-them">
              ${statement}
            </p>
          </div>
          <div class="col-3">
            <div class="listener">
            <em style="font-size: 15; color: #006cd8;  font-weight: bold;">Listener identity</em>: <span id="listenerInput">${listenerIdentity}</span>
            </div>
          </div>
          <div class="col-12">
            <label style="text-align: right; float: right; margin: 1em 0;">
              <input id="dontUnderstand" name="dontUnderstand" type="checkbox" onclick="toggleDontUnderstandAck(this.checked)">I'm having a lot of trouble understanding this message.
            </label>
          </div>
        </div>
        <div class="col-6 alert alert-warning" id="dontUnderstandAck" style="display: none;">
          Thanks for letting us know that the message/context is hard to understand! Please still try your best to answer the questions below!
        </div>

        <div class="col-12 mt-5 mb-2">
          <h4 style="font-style: italic;">1. Does the <span class="cb-teal">situation</span> seem plausible/realistic?</h4>
        </div>
        <table class="table table-striped" id="inputTable">
          <tr>
            <td class="cb-teal" style="width: 15%;">Situation</td>
            <td class="cb-gray" style="width: 20%;">${speechContext}</td>
            <td style="width: 50%;">
              <label>very implausible <input class="agreement" type="radio" for="situationRating" name="situationRating" value=0 required></label>
              <label><input class="agreement" type="radio" for="situationRating" name="situationRating" value=1> </label>
              <label><input class="agreement" type="radio" for="situationRating" name="situationRating" value=2> </label>
              <label><input class="agreement" type="radio" for="situationRating" name="situationRating" value=3> </label>
              <label><input class="agreement" type="radio" for="situationRating" name="situationRating" value=4> very plausible</label></td>
            <td>Suggest a better situation:<br>
            <input type="text" placeholder="..." name="situationSuggestion"></td>
          </tr>
        </table>

        <div class="col-12 mt-5 mb-2">
          <h4 style="font-style: italic;">2. Does the <span class="cb-purple">speaker identity</span> seem plausible/realistic?	</h4>
        </div>
        <table class="table table-striped" id="inputTable"> 
          <tr>
            <td class="cb-purple" style="width: 15%;">Speaker identity</td>
            <td class="cb-gray" style="width: 20%;">${speakerIdentity}</td>
            <td style="width: 50%;">
              <label>very implausible <input class="agreement" type="radio" for="speakerIdenRating" name="speakerIdenRating" value=0 required></label>
              <label><input class="agreement" type="radio" for="speakerIdenRating" name="speakerIdenRating" value=1> </label>
              <label><input class="agreement" type="radio" for="speakerIdenRating" name="speakerIdenRating" value=2> </label>
              <label><input class="agreement" type="radio" for="speakerIdenRating" name="speakerIdenRating" value=3> </label>
              <label><input class="agreement" type="radio" for="speakerIdenRating" name="speakerIdenRating" value=4> very plausible</label></td>
            <td>Suggest a better speaker identity:<br>
            <input type="text" placeholder="..." name="speakerIdenSuggestion"></td>
          </tr>
        </table>

        <div class="col-12 mt-5 mb-2">
          <h4 style="font-style: italic;">3. Does the <span class="cb-orange">listener identity</span> seem plausible/realistic?</h4>
        </div>
        <table class="table table-striped" id="inputTable">
          <tr>
            <td class="cb-orange" style="width: 15%;">Listener identity</td>
            <td class="cb-gray" style="width: 20%;">${listenerIdentity}</td>
            <td style="width: 50%;">
              <label>very implausible <input class="agreement" type="radio" for="listenerIdenRating" name="listenerIdenRating" value=0 required></label>
              <label><input class="agreement" type="radio" for="listenerIdenRating" name="listenerIdenRating" value=1> </label>
              <label><input class="agreement" type="radio" for="listenerIdenRating" name="listenerIdenRating" value=2> </label>
              <label><input class="agreement" type="radio" for="listenerIdenRating" name="listenerIdenRating" value=3> </label>
              <label><input class="agreement" type="radio" for="listenerIdenRating" name="listenerIdenRating" value=4> very plausible</label></td>
            <td>Suggest a better listener identity:<br>
            <input type="text" placeholder="..." name="listenerIdenSuggestion"></td>
          </tr>
        </table>

        <!-- <div class="col-12 mt-5 mb-2">
          <h4 style="font-style: italic;">4. Does the overall context (situation, speaker, listener) help understand the biased statement?</h4>
        </div>
        <table class="table table-striped" id="inputTable">
          <tr>
            <td class="cb-gold" style="width: 15%;">Overall context</td>
            <td class="cb-gray" style="width: 20%;"></td>
            <td style="width: 50%;">
              <label>very little <input class="agreement" type="radio" for="overallRating" name="overallRating" value=4 required></label>
              <label><input class="agreement" type="radio" for="overallRating" name="overallRating" value=3> </label>
              <label><input class="agreement" type="radio" for="overallRating" name="overallRating" value=2> </label>
              <label><input class="agreement" type="radio" for="overallRating" name="overallRating" value=1> </label>
              <label><input class="agreement" type="radio" for="overallRating" name="overallRating" value=0> very much</label></td>
              <td><br>
          </tr>
        </table> -->
        
        <div class="col-12 mt-5 mb-2">
          <h4 style="font-style: italic;">Attention check</h4>
        </div> 
        <table class="table table-striped" id="inputTable">
          <tr>
            <td class="cb-gray" style="width: 30%;">Please select the <span id="attentionCheckInstr">fifth</span> option from the top, to double check you're doing this task attentively.</td>
            <div style="display: none;">
              <input name="attentionCheckCorrect" id="attentionCheckCorrect" placeholder="3" type="number">
            </div>
            <td>
              <label><input class="attentionCheck" type="radio" for="attentionCheck" name="attentionCheck" value="1" required> 1</label><br>
              <label><input class="attentionCheck" type="radio" for="attentionCheck" name="attentionCheck" value="2"> 2</label><br>
              <label><input class="attentionCheck" type="radio" for="attentionCheck" name="attentionCheck" value="3"> 3</label><br>
              <label><input class="attentionCheck" type="radio" for="attentionCheck" name="attentionCheck" value="4"> 4</label><br>
              <label><input class="attentionCheck" type="radio" for="attentionCheck" name="attentionCheck" value="5"> 5</label>
            </td>
            <td><br>
         </tr>
        </table>
      </div>
    </div>
  
    <div class="row justify-content-center">
      <div class="col-9" id="commentSection" style="display: inline-block;text-align: center;">
        <p style="font-size:10pt;margin-top: 50px;">
          Optional Feedback: Thanks for filling out the questions above!
          If something about the hit was unclear, please either leave a comment in the box below!
          We would like to make this HIT easier for future workers, so we really appreciate feedback though it is optional.
          <br>
          If you have concerns or questions, please email us!
        </p>
        <textarea style="margin-left:10px;margin-top:10px;width: 95%;" rows="2" name="commentbox"></textarea>
        <br><br>
        <center>
          <div class="alert alert-danger" id="submitAlert" style="display: none;">
            Whoops you missed some questions!
            <br>
            Note: if the submit button is disabled and you're confident this is an error, please screenshot your answers and the console output (Ctrl+Shift+J or Cmd+Shift+J).
          </div>
          <input type="submit" id="submitButton" class="btn btn-primary" value="Submit Hit!">       
        </center>
      </div>
    </div>
  </div>
</fieldset>
</section>

<script>
  var targ, btngroup, event, selectedText, aspectDiv, workerInfo;
  var attentionChecks = ["first","second", "third", "fourth", "fifth"];
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
  function scrollToAnchor(aid){
    console.log(aid);
    var aTag = $(aid);
    $('html,body').animate({scrollTop: aTag.offset().top},'slow');
  }
  $("label.btn-checkbox>input[type='checkbox']").each(function(ix,e){
    var value = $(e).parent().prop("innerText").trim();
    e.value = value == "" ? "_other_" : value;
  });

  /* Make the textbox (suggestion) required for the value in a certain range */
  $(".agreement").on("click",function(e){ 
    event = e; 
    var dim = e.target.name.replace(/Rating/,"")
    var val = parseInt($("input[name='"+dim+"Rating']:checked").prop("value"));
    console.log(dim,val);
    if (val < 2 && val > -1) 
      $("input[name='"+dim+"Suggestion']").prop("required","true");
    else 
      $("input[name='"+dim+"Suggestion']").prop("required","");
  })
  $(".btn-checkbox").on("click",function(e){
    targ = e.target;
    aspectDiv = $(targ).closest(".card-body").find(".aspects");

    /* Highlight button if checkbox is clicked */
    if(e.target.tagName == "INPUT"){
      if (targ.checked)
        $(targ).parent().addClass("active");
      else 
        $(targ).parent().removeClass("active");
    }
    
    /* Make textboxes required if any checkbox is checked */
    if ($(targ).closest(".btn-group-vertical").find("input:checkbox:checked").length > 0) {
      aspectDiv.show();
      aspectDiv.find("input[type='text']").each(function (i,e){
        if (i>1)
          return;
        $(e).prop("required","true");
      });
    } else {
      aspectDiv.hide();
      aspectDiv.find("input[type='text']").each(function (i,e){
        $(e).prop("value","");
        if (i>1)
          return;
        $(e).prop("required","");
      });
    }
    alertMinorityQs("yes");
  });
  $('.collapse-checkbox').on('hide.bs.collapse', function (e) {
  /* If any checkboxes are checked, this makes sure the buttons don't disappear */
  btngroup = e.target;
  if ($(btngroup).find("input:checkbox:checked").length > 0)
    e.preventDefault();
  })
  $(".othercheckbox").on("click",function(e){
    var checked = $(e.target).prop("checked")
    $(e.target).next().prop("disabled",!checked);
    $(e.target).next().prop("required",checked? "true": "");
  });
  $("input[type='text']").prop("pattern",".{0}|.{3,}").prop("title","Minimum 3 characters");

  
  $("button.btn-link").on("click",function(e){
    //Not sure why I need this, but otherwise accordion submits immediately
    e.preventDefault();
    event = e;
    //console.log(e.target);
  });
  $("#submitButton").on("click",function(e){
    var val = validate();
    if (!val) {
      e.preventDefault();
      event = e;
      $("#submitAlert").show();
      setTimeout(function(){
        $("#submitAlert").hide(300);
      }, 10000);
    } else {
      // sendWorkerInfo();
      $("#clickedSubmitTime").val((new Date()).getTime());
      console.log("Submitted");
    }
  });
  function layout(){
    $("#postText").each(function (i,e){
      ee = e;
      //e.innerText = renderEmoji(e.innerText);
    });
    var attnIx = Math.floor(Math.random()*attentionChecks.length);
    console.log("Attention check "+(attnIx+1)+" "+attentionChecks[attnIx])
    $("#attentionCheckInstr").text(attentionChecks[attnIx]);
    $("#attentionCheckCorrect").val(attnIx+1);
  }
  // function getURLParams(){
  //   var search = location.search;
  //   if (location.hostname === "homes.cs.washington.edu"){
  //     search = "?workerId=A1TW2IIFTWJIB2&hitId=Testing";
  //     console.log(search)
  //   }
    
  //   search = search.substring(1);
  //   if (search == ""){
  //     console.log("No search params "+location.href);
  //     return {};
  //   }
  //   var params = JSON.parse('{"' + search.replace(/&/g, '","').replace(/=/g,'":"') + '"}', function(key, value) { return key===""?value:decodeURIComponent(value) });

  //   params["HITId"] = params["hitId"];
  //   params["HITType"] = "contextSBF-validation";
  //   console.log(params);
  //   return params;
  // }
  function toggleConsent(checked){
    if (checked){
      $("#actualTask").show();
      $("#consentMessage").hide();
      $("#clickedConsentTime").val((new Date()).getTime());
      scrollToAnchor("#actualTask");
    } else {
      $("#actualTask").hide();
      $("#consentMessage").show();
    }
  }
  function toggleDontUnderstandAck(checked){
    if(checked)
      $("#dontUnderstandAck").show()
    else
      $("#dontUnderstandAck").hide()
  }
  // function prepSQLparamsCheck(urlParams){
  //   var out="";
  //   out += "tableName="+"workerDemographics";
  //   out += "&workerId="+urlParams["workerId"];
  //   out += "&HITType="+urlParams["HITType"];
  //   out += "&assignmentId="+urlParams["assignmentId"];
  //   out += "&HITId="+urlParams["HITId"];
  //   return out;
  // }
  // function prepSQLparamsStore(){
  //   var out="";
  //   out += "tableName="+"workerDemographics";
  //   out += "&gender="+$("#annotatorGender").val();
  //   out += "&age="+$("#annotatorAge").val();
  //   out += "&race="+$("#annotatorRace").val();
  //   out += "&politics="+$('input[name="annotatorPolitics"]:checked').val();
  //   out += "&otherMinority="+encodeURIComponent($("#annotatorMinority").val());

    
  //   return out;
  // }
  // function dealWithWorkerInfo(sqlResponse){
  //   if (sqlResponse == ""){
  //     /* we don't have this worker in our DB*/
  //     console.log("New worker!");
  //     $(".prefilled-message").hide();
  //     if (location.hostname == "homes.cs.washington.edu"){
  //       $("#consent").prop("checked",true);
  //       toggleConsent(true);
  //     }
  //   } else {
  //     workerInfo = JSON.parse(sqlResponse);
  //     console.log(workerInfo);
  //     // Bypass consent? Only on UW servers
  //     if (location.hostname == "homes.cs.washington.edu"){
  //       $("#consent").prop("checked",true);
  //       toggleConsent(true);
  //     }
  //     $(".prefilled-message").show();
  //     $("#annotatorGender").val(workerInfo["gender"]);
  //     $("#annotatorAge").val(workerInfo["age"]);
  //     $("#annotatorRace").val(workerInfo["race"]);
  //     //$("#annotatorPolitics").val(workerInfo["politics"]);
  //     $('#annotatorPolitics'+workerInfo["politics"]).prop("checked",true)
  //     $("#annotatorMinority").val(workerInfo["otherMinority"]);
    
  //   }
  // }
  function checkIfWorkerExists(){
    var urlParams = getURLParams();
    var requestParams = "?"+prepSQLparamsCheck(urlParams)+"&action=check";//location.search+"&action=check";
    var requestURL = "https://homes.cs.washington.edu/~msap/debug/neural-detox/checkStoreWorkerDemographicsMore.php";
    var xhttp = new XMLHttpRequest();
    console.log(requestURL+requestParams);
    xhttp.open("POST", requestURL+requestParams, true);
    xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        //var responseRaw = this.responseText;
        dealWithWorkerInfo(this.responseText);
        //console.log("Received an answer!"+this.responseText);
      }
    };
    xhttp.send(requestParams);
  }
  // function sendWorkerInfo(){
  //   var urlParams = getURLParams();
  //   var requestParams = "?"+prepSQLparamsCheck(urlParams)+"&action=store&"+prepSQLparamsStore();
  //   var requestURL = "https://homes.cs.washington.edu/~msap/debug/neural-detox/checkStoreWorkerDemographicsMore.php";
  //   var xhttp = new XMLHttpRequest();
  //   console.log(requestURL+requestParams);
  //   xhttp.open("POST", requestURL+requestParams, true);
  //   xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
  //   xhttp.onreadystatechange = function() {
  //     if (this.readyState == 4 && this.status == 200) {
  //       //var responseRaw = this.responseText;
  //       //dealWithWorkerInfo(this.responseText);
  //       console.log("Received an answer: '"+this.responseText+"'");
  //     }
  //   };
  //   xhttp.send(requestParams);
  // }
  function validate(){
  
    valid = $("input:invalid").length == 0;
    console.log("########## VALIDATING #########\nvalid? "+valid);
    $("input:invalid").each(function (i,e){
      console.log(e);
    });
    return valid;
  }
  function alertMinorityQs(val){
    if (val == "yes" && $(".btn-checkbox>input:checked").length == 0) {
      //$("#dummyMinority").prop("required","true");
      $("#alertQminority").show();
    } else {
      //$("#dummyMinority").prop("required","");
      $("#alertQminority").hide();
    }
  }
  var rows;
  function expRows(){
    rows = $("tr.extra-rows");
    $("a:contains('examples')").each(function(ix,link){
      if (rows.hasClass("show"))
        link.innerText = "[+] more examples";
      else 
        link.innerText = "[-] less examples";
      console.log(link);
    })
  }

  var divs;
  function expExamples(){
    divs = $("div.extra-exs");
    $("a:contains('examples')").each(function(ix,link){
      if (divs.hasClass("show"))
        link.innerText = "[+] more examples";
      else 
        link.innerText = "[-] less examples";
      console.log(link);
    })
  }

</script>
<style type="text/css">

#examples-table {
  /*border-style: none solid none solid;*/
  border-width: 1px;
  border-color: #dee2e6;
  border-radius: 5px;
  padding: 2px;
}
#examples-table td {
  border-top: #dee2e6;
  border-bottom: #dee2e6;
  border-left: #ffffff;
  border-right: #ffffff;
  border-style: solid;
  border-width: 1px;
  padding: 2px;
}

#inputTable {
  border:0px solid #b3adad;
  border-collapse:collapse;
  padding:5px;
}
#inputTable td {
  border:0px solid #b3adad;
  padding:5px;
}

.card-header-accordion{
  padding: 0px 10px;
}
body, td, .btn { 
  /*font-size:0.85rem;*/
}
label {
  margin-bottom: 0px;
}
.story-excerpt {
  margin: 40px auto;
  min-width: 500px;
  border:2px #333333;
  background-color: #f2f2f2;
  border-style: solid;
  padding-right:10px;
  padding-left:10px;
  display:table;
  border-radius:15px;
}
.story-excerpt-example {
  border: 1px solid #666666;
  background-color: #f2f2f2;
  border-radius: 3px;
  padding: 3px;
  display: inline-block;
  margin: 10px;
}
span.numbering {
  font-weight: bold;
  margin-right: .5em;
}
#introQuestion>div>label>input,
#intentQuestion>div>label>input {
  vertical-align: middle;
}
.prefilled-message{
  font-style: italic;
}

#detailed-instructions>p {
  margin-bottom: 0px;
}
span.instrQuestion {
  background-color: #f2f2f2;
  font-style: italic;
  font-size: .9rem;
  margin: 5px 0 3px -15px;
  padding: 0 .3rem 0 .3rem;
  display: inline-block;
}
span.instrDescription {
  font-size: .9rem;
  margin-left: -15px;
}
label > input[type='text'] {
  width: 90%;
}
input[type='text'] {
  width: 300px;
}
input[type='text'].opt-target {
  background-color: #f8f8f8;
}

input[type="text"]:invalid {
  color: #a94442;
  background-color: #f2dede;
}

textarea#postText {
  margin-left: 20px;
  font-size: 12pt;
  width: auto;
  background-color: transparent;
  overflow: auto;
  resize: none;
}

.btn-checkbox, .btn-checkbox-two {
  .btn-light;
  color: black;
  text-align: left;
  margin: 0px;
  background-color: #e9ecef;
  border-color: #d1d4d7;
}

.btn-checkbox.active,
.btn-checkbox:active,
.btn-checkbox:hover {
  background-color: #babcbf;
  border-color: #8b8d8f;
}

.btn-checkbox-two.active,
.btn-checkbox-two:active,
.btn-checkbox-two:hover {
  background-color: #babcbf;
  border-color: #8b8d8f;
}

.btn-group-vertical {
  max-width: 400px;
  /*margin-right: 10px;*/
}
#introQuestion, 
#minorityQuestions,
#demogQuestions {
  margin-bottom: 10px;
  margin-top: 10px;
}
.autocomplete-suggestions { 
  border: 1px solid #999;
  background: #FFF; 
  overflow: auto;
}
#dummyMinority {
  /*opacity:0;*/
  width: 0px;
}
.autocomplete-suggestion { padding: 2px 5px; white-space: nowrap; overflow: hidden; }
.autocomplete-selected { background: #F0F0F0; }
.autocomplete-suggestions strong { font-weight: normal; color: #3399FF; }
.autocomplete-group { padding: 2px 5px; }
.autocomplete-group strong { display: block; border-bottom: 1px solid #000; }

input[type='checkbox'] {
  /* All <input> elements that are immediate children of a class="btn-checkbox" */
  margin-right: 5px;
}
ul {
  padding-left: 30px;
  margin-bottom: 10px;
}
fieldset {
  padding: 10px;
  background:#fbfbfb;
  border-radius:5px; 
  margin-bottom:5px;
}
.lickert>label{
    font-style: italic;
  }
  
.cb-teal {
  color: #1b9e77;
  font-weight: bold;

}
.cb-orange {
  color: #d95f02;
  font-weight: bold;
}
.cb-purple {
  color: #7570b3;
  font-weight: bold;
}
.cb-pink {
  color: #e7298a;
  font-weight: bold;
}
.cb-green {
  color: #66a61e;
  font-weight: bold;
}
.cb-gold {
  color: #e6ab02;
  font-weight: bold; 
}
.cb-brown{
  color: #a6761d;
  font-weight: bold;
}
.cb-gray{
  color: #3f3f3f;
}
.cb-bg-teal {
  background-color: #1b9e77
}
.cb-bg-orange {
  background-color: #d95f02
}
.cb-bg-purple {
  background-color: #7570b3
}
.cb-bg-pink {
  background-color: #e7298a
}
.cb-bg-green {
  background-color: #66a61e
}
.cb-bg-gold {
  background-color: #e6ab02 
}
.cb-bg-brown{
  background-color: #a6761d
}
todo {
  font-style: italic;
  font-weight: bold;
  color: #e60000;
  background-color: black;
}

.possibleAnswer {
  margin-left: 2em;
}
.badTd {
  background: #FF8C8C;
}
.goodTd{
  background: #14C38E;
}

/*********************************/
.imessage {
  background-color: #fff;
  border: 1px solid #e5e5ea;
  border-radius: 0.25rem;
  display: flex;
  flex-direction: column;
  /*font-family: "SanFrancisco";*/
  /*font-size: 1.25rem;*/
  margin: 0 auto 1rem;
  max-width: 600px;
  padding: 0.5rem 1.5rem;
}

.imessage p {
  border-radius: 1.15rem;
  line-height: 1.25;
  max-width: 75%;
  padding: 0.5rem .875rem;
  position: relative;
  word-wrap: break-word;
}

.imessage p::before,
.imessage p::after {
  bottom: -0.1rem;
  content: "";
  height: 1rem;
  position: absolute;
}

p.from-me {
  align-self: flex-end;
  background-color: #248bf5;
  color: #fff; 
}

p.from-me::before {
  border-bottom-left-radius: 0.8rem 0.7rem;
  border-right: 1rem solid #248bf5;
  right: -0.35rem;
  transform: translate(0, -0.1rem);
}

p.from-me::after {
  background-color: #fff;
  border-bottom-left-radius: 0.5rem;
  right: -40px;
  transform:translate(-30px, -2px);
  width: 10px;
}

p[class^="from-"] {
  margin: 0.5rem 0;
  width: fit-content;
}

p.from-me ~ p.from-me {
  margin: 0.25rem 0 0;
}

p.from-me ~ p.from-me:not(:last-child) {
  margin: 0.25rem 0 0;
}

p.from-me ~ p.from-me:last-child {
  margin-bottom: 0.5rem;
}

p.from-them {
  align-items: flex-start;
  background-color: #e5e5ea;
  color: #000;
}

p.from-them:before {
  border-bottom-right-radius: 0.8rem 0.7rem;
  border-left: 1rem solid #e5e5ea;
  left: -0.35rem;
  transform: translate(0, -0.1rem);
}

p.from-them::after {
  background-color: #fff;
  border-bottom-right-radius: 0.5rem;
  left: 20px;
  transform: translate(-30px, -2px);
  width: 10px;
}

p[class^="from-"].emoji {
  background: none;
  font-size: 2.5rem;
}

p[class^="from-"].emoji::before {
  content: none;
}

.no-tail::before {
  display: none;
}

.margin-b_none {
  margin-bottom: 0 !important;
}

.margin-b_one {
  margin-bottom: 1rem !important;
}

.margin-t_one {
  margin-top: 1rem !important;
}
.speaker {
  border-radius: .2em;
  background-color: #ACCFF2;/*#D5E7F9;*/
  padding: .5em;
}
.listener {
  border-radius: .2em;
  background-color: #CAE1F7;
  padding: .5em;
}
.situation {
  border-radius: .2em;
  background-color: #DDECFA;
  padding: .5em;
}
</style>
</body>
</html>