<script>
//
// This method Gets URL Parameters (GUP)
//
function gup( name )
{
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var tmpURL = window.location.href;
  var results = regex.exec( tmpURL );
  if( results == null )
    return "";
  else
    return results[1];
}
function decode(strToDecode)
{
  var encoded = strToDecode;
  return unescape(encoded.replace(/\+/g,  " "));
}

window.onload = function() {
    if (!window.jQuery) {  
        // jQuery is not loaded
        alert("Warning: it seems that jquery is disabled on your browser.  This HIT might not work properly without javascript and jquery code enabled (if you have extensions that block jquery or an old browser version, this may prevent the dynamic elements of the HIT from functioning).  Please ensure that you have jquery enabled by temporarily disabling extensions that interfere with jquery and/or trying a different browser version."); 
    }
    checkIfWorkerExists();
    layout();
}
</script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<!--For autocomplete-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.devbridge-autocomplete/1.4.7/jquery.autocomplete.js"></script>
<!--link ref="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-autocomplete/1.0.7/jquery.auto-complete.css"-->

<script src="https://homes.cs.washington.edu/~msap/debug/neural-detox/emoji.json" ></script>

<script src="https://homes.cs.washington.edu/~msap/debug/neural-detox/emojiv2.js"></script>


<section class="container" id="preInstruction" style="margin-bottom:0px; padding: 0px 10px; font-family: Verdana, Geneva, sans-serif; color:#333333;">
<div class="card">
<div class="card-header" style="color: #fff;background-color: #337ab7;border-color: #337ab7;"><strong>Instructions</strong></div>
<div class="card-body">
  Read a potentially toxic message from the internet and some explanations of what it means, and tell us whether you agree with the explanations (this should take less than 5 minutes).
  Note: this is a pilot task, more HITs will be available in the future.
  <br>
  <em><strong>Participation restriction: </strong>providers/turkers for this task cannot currently be employed by or a student at the University of Washington.</em>
</div>
</div>
</section>

<!--END OF HIT HEADER; START OF HIT BODY-->
<section class="container" style="font-family: Verdana, Geneva, sans-serif; color:#333333;">
  <fieldset>
    <div class="card" style="display: block;">
      <div class="card-header">
        <h4 class="card-title" style=""> 
          Full Instructions &nbsp; &nbsp;
          <a data-toggle="collapse" href="#instructions" role="button" aria-expanded="false" aria-controls="instructions" style="color:#0080ff;text-decoration: underline;">
          (Expand/Collapse)
          </a> 
        </h4>
      </div>
      <div id="instructions" class="collapse show" style="margin:10px">
        <div class="row">
          <div class="col-12 mb-4">
            <p style="font-size: 1.05rem; text-align: left">
              You will read a message taken from somewhere on the internet, the machine-generated potential listener and speaker identity and the situation where the message happened. And then, you will rate some explanations of the message. Please answer all questions from an American cultural perspective; try to think about what other people in today's society would think about these. Note: we will assume that MTurk workers only have good intentions when annotating these posts.
           </p>
          </div>
        </div>
        <div class="row">
          <div class="col-8">
            <h5>Detailed instructions</h5>
            
            <p style="margin-bottom: .5rem;">
              <em class="toyou"><span class="numbering">1)</span> 
                Read the message carefully. 
                When you interpret the message, make sure you take into account the speaker and listener's
                identities as well as the situation.
              </em>
            </p>

            <p style="margin-bottom: .5rem;">
              <em class="toyou"><span class="numbering">2)</span> Rate the following explanations of the message. 
                If you think the provided explanation is somewhat unlikely or unlikely, please suggest a better 
                explanation using the text box beside the radio buttons. <xuhui>(Xuhui: would this push people to rate things more likely?)</xuhui> 
                The following table provides you with the questions
                you should consider when rating or writing the explanation for each category.
                <br>
                <table id="examples-table">
                  <tr>
                    <td class="cb-teal">Speaker intent</td>
                    <td class="cb-teal">What do you think the speaker was trying to say? What was their intent with this statement?</td>
                  </tr>
                  <tr>
                    <td class="cb-purple">Targeted Group</td>
                    <td class="cb-purple">Who is referenced or targeted by the statement? It could be demographic groups and/or the listener themselves.</td>
                  </tr>
                  <tr>
                    <td class="cb-gold">Power dynamic</td>
                    <td class="cb-gold">Which power difference/marginalization/oppression does the statement happen on?
                    </td>
                  </tr>
                  <tr>
                    <td class="cb-orange">Implication</td>
                    <td class="cb-orange">What is the biased or harmful or stereotypical implication that the statement carries (perhaps unintentionally)?
                    </td>
                  </tr>
                  <tr>
                    <td class="cb-green">Targeted group emotional reaction</td>
                    <td class="cb-green">What are some of the immediate emotional reactions that someone from the targeted group would have to this statement/biased implication?
                    </td>
                  </tr>
                  <tr>
                    <td class="cb-brown">Targeted group cognitive reaction</td>
                    <td class="cb-brown">Longer-term, what likely lessons will someone from the targeted group draw? How will they change their thinking or behavior?
                    </td>
                  </tr>
                  <tr>
                    <td class="cb-pink">Type of offensiveness&nbsp;</td>
                    <td class="cb-pink">Overall, using only a few words, how would you describe the offensiveness of the statement? This statement is an example of a ____.
                    </td>
                  </tr>
                </table>
                <br>
                <b>Note</b>: Think about cognitive reactions as the likely lessons someone will draw or the likely subsequent actions someone will take. 
                It's more long-term harm, whereas emotional reactions are more about immediate emotional reactions and feelings, which is more immediate harm.
              </em>
            </p>
            <br>

            <p style="margin-bottom: .5rem;">
              <em><span class="numbering">3)</span>Indicate your gender, age, race, political leaning, and whether you identify as a minority (this will remain confidential).</em><br>
              Your own personal background and experiences influence what you think of as disrespectful or offensive.
              We collect this information to account for all types of backgrounds that MTurkers come from in our research.
              <em>If you answered this question once, your answers should pre-load in subsequent HITs.</em>
            </p>
          </div>
          <div class="col-4">
          <small>
            <h5>Background on our research project</h5>
            <p>
              At the University of Washington, we're passionate about understanding how potentially toxic or disrespectful language or stereotypes can be used against certain demographics/groups of people (e.g. racism, sexism, etc.).
              Although there is no direct benefit to you for participating, we very much appreciate your help in identifying and explaining such language/stereotypes, since this is something computational models have no clue about. 
              We do not agree with any of the content/stereotypes presented to you, but it's important that we gather these annotations for research purposes.
            </p>
            <p>
              <strong>Data collection &amp; sharing</strong><br>
              We will not ask you for your name, and the data collected in this study will be made unidentifiable to the best of our extent.
              We will securely store the data on our servers and only share with qualified researchers (e.g. who want to further the study of hate speech detection).
              If you later decide that you do not want your responses included in this study, please email so we can exclude your work.
              <br>
              If you have questions about your rights as a research participant, or wish to obtain information, ask questions or discuss any concerns about this study with someone other than the researcher(s), please contact the University of Washington Human Subjects Division at 206-543-0098 (for international calls include the US Calling Code: +1-206-543-0098).
            </p>
          </small>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <p class="mt-4">
              <em><strong style="color: #e60000;">Content Warning</strong></em>: posts were found on the (uncensored) internet;
              while it's crucial for us to annotate them, we do not endorse any of the stereotypes or offensive/immoral/rude material.
              You may find some of the content upsetting.
              <em>If you have concerns, questions, or strong negative reactions to some of the content</em>, please either email us (Maarten Sap at msap@cs.washington.edu, or Professor Yejin Choi at yejin@cs.washington.edu) or <a href="https://www.crisistextline.org/">reach out</a> if in crisis.
            </p>
          </div>
        </div>
        
      </div>
    </div>
    <div class="row" id="consent" style="margin: 30px 0;">
      <div class="col-12">
        
        <h6>You have read and understood the instructions and agree to do the task</h6>
        <div class="form-check">
          <label class="form-check-label">
            <input class="form-check-input" type="checkbox" id="consent" name="consent" onclick="toggleConsent(this.checked)">
            By ticking this box, you are agreeing to be part of this data collection study. Be sure that questions you have about the study have been answered and that you understand what you are being asked to do. You may contact us if you think of a question later. You are free to release/quit the HIT at any time, and refusing to be in the experiment or stopping participation will involve no penalty or loss of benefits to which you are otherwise entitled. To save a copy of the consent form and instructions, you can save/print this webpage (or find the instructions <a href="https://homes.cs.washington.edu/~msap/debug/neural-detox/psychOffensivenessLargeScale.html">here</a>).
            <xuhui>(Xuhui: the link needs to be updated) </xuhui>
          </label>
        </div>
        <br>
        <div class="alert alert-warning" id="consentMessage" style="max-width: 400px;margin: auto;">
          You must check the box to continue the task!
        </div>
        <div style="display: none;">
          <input name="clickedConsentTime" id="clickedConsentTime" type="text" placeholder="">
          <input name="clickedSubmitTime" id="clickedSubmitTime" type="text" placeholder="">
        </div>
      </div>
    </div>
    <div id="actualTask" style="display: none;">
      <div class="row justify-content-center" style="background-color: ghostwhite; border: 1px solid darkgrey; border-radius: 3px; width: 70%; margin-left: auto; margin-right: auto;">
        <div class="col-12 text-center" style="margin: 1em 0;">
          <em>Situation</em>: <span id="speechContextInput">${speechContext}</span>
        </div>
        <div class="col-3">
          <em>Speaker identity</em>: <span id="speakerInput">${speakerIdentity}</span>
        </div>
        
        <div class="col-6 imessage">
          <p class="from-them">
            ${statement}
          </p>
        </div>
        <div class="col-3">
          <em>Listener identity</em>: <span id="listenerInput">${listenerIdentity}</span>
        </div>
        <div class="col-12">
          <label style="text-align: right; float: right; margin: 1em 0;">
            <input id="dontUnderstand" name="dontUnderstand" type="checkbox" onclick="toggleDontUnderstandAck(this.checked)">I'm having a lot of trouble understanding this message.
          </label>
        </div>
      </div>
      <div class="container" id="allQuestions">
      <div class="row justify-content-center">
        <div class="col-6 alert alert-warning" id="dontUnderstandAck" style="display: none;">
          Thanks for letting us know that this message is hard to understand! Please still try your best to answer the questions below!
        </div>
        <div class="col-12 mt-5 mb-2">
          <h4 style="font-style: italic;">1. Rate the explanations about the message.</h4>
        </div>
        <table id="inputTable">
          <tr>
            <td class="cb-teal">Speaker intent</td>
            <td class="cb-teal">${intent}</td>
            <td>
              <label><input class="likelihood" type="radio" for="intentRating" name="intentRating" value=3 required> Very likely</label><br>
              <label><input class="likelihood" type="radio" for="intentRating" name="intentRating" value=2> Somewhat likely</label><br>
              <label><input class="likelihood" type="radio" for="intentRating" name="intentRating" value=1> Somewhat unlikely</label><br>
              <label><input class="likelihood" type="radio" for="intentRating" name="intentRating" value=0> Very unlikely</label></td>
            <td>Suggest a better speaker intent:<br>
            <input type="text" placeholder="speaker was trying to..." name="intentSuggestion"></td>
          </tr>
          <tr>
            <td class="cb-purple">Targeted Group</td>
            <td class="cb-purple">${targetGroup}&nbsp;</td>
            <td>
              <label><input class="likelihood" type="radio" for="targetGroupRating" name="targetGroupRating" value=3 required> Very likely</label><br>
              <label><input class="likelihood" type="radio" for="targetGroupRating" name="targetGroupRating" value=2> Somewhat likely</label><br>
              <label><input class="likelihood" type="radio" for="targetGroupRating" name="targetGroupRating" value=1> Somewhat unlikely</label><br>
              <label><input class="likelihood" type="radio" for="targetGroupRating" name="targetGroupRating" value=0> Very unlikely</label></td>
            <td>Suggest a better targeted group:<br>
            <input type="text" placeholder="..." name="targetGroupSuggestion"></td>
          </tr>
          <tr>
            <td class="cb-gold">Power dynamic</td>
            <td class="cb-gold">${relevantPowerDynamics}</td>
            <td>
              <label><input class="likelihood" type="radio" for="powerDiffRating" name="powerDiffRating" value=3 required> Very likely</label><br>
              <label><input class="likelihood" type="radio" for="powerDiffRating" name="powerDiffRating" value=2> Somewhat likely</label><br>
              <label><input class="likelihood" type="radio" for="powerDiffRating" name="powerDiffRating" value=1> Somewhat unlikely</label><br>
              <label><input class="likelihood" type="radio" for="powerDiffRating" name="powerDiffRating" value=0> Very unlikely</label>
            </td>
            <td>Suggest a better relevant power difference:<br>
            <input type="text" name="powerDiffSuggestion" placeholder="power difference between..."></td>
          </tr>
          <tr>
            <td class="cb-orange">Implication</td>
            <td class="cb-orange">${implication}&nbsp;</td>
            <td>
              <label><input class="likelihood" type="radio" for="implicationRating" name="implicationRating" value=3 required> Very likely</label><br>
              <label><input class="likelihood" type="radio" for="implicationRating" name="implicationRating" value=2> Somewhat likely</label><br>
              <label><input class="likelihood" type="radio" for="implicationRating" name="implicationRating" value=1> Somewhat unlikely</label><br>
              <label><input class="likelihood" type="radio" for="implicationRating" name="implicationRating" value=0> Very unlikely</label>
            </td>
            <td>Suggest a better implication or stereotype:<br>
            <input type="text" name="implicationSuggestion" placeholder="message implies that ..."></td>
          </tr>
         <tr>
            <td class="cb-green">Targeted group emotional reaction</td>
            <td class="cb-green">${targetGroupEmotionalReaction}</td>
            <td>
              <label><input class="likelihood" type="radio" for="targetGroupReactionRating" name="targetGroupReactionRating" value=3 required> Very likely</label><br>
              <label><input class="likelihood" type="radio" for="targetGroupReactionRating" name="targetGroupReactionRating" value=2> Somewhat likely</label><br>
              <label><input class="likelihood" type="radio" for="targetGroupReactionRating" name="targetGroupReactionRating" value=1> Somewhat unlikely</label><br>
              <label><input class="likelihood" type="radio" for="targetGroupReactionRating" name="targetGroupReactionRating" value=0> Very unlikely</label>
            </td>
            <td>Suggest a better reaction:<br>
            <input type="text" name="targetGroupReactionSuggestion" placeholder="targeted group would likely feel..."></td>
          </tr>
          <tr>
            <td class="cb-brown">Targeted group cognitive reaction</td>
            <td class="cb-brown">${targetGroupCognitiveReaction}</td>
            <td>
              <label><input class="likelihood" type="radio" for="targetGroupEffectRating" name="targetGroupEffectRating" value=3 required> Very likely</label><br>
              <label><input class="likelihood" type="radio" for="targetGroupEffectRating" name="targetGroupEffectRating" value=2> Somewhat likely</label><br>
              <label><input class="likelihood" type="radio" for="targetGroupEffectRating" name="targetGroupEffectRating" value=1> Somewhat unlikely</label><br>
              <label><input class="likelihood" type="radio" for="targetGroupEffectRating" name="targetGroupEffectRating" value=0> Very unlikely</label>
            </td>
            <td>Suggest a better reaction:<br>
            <input type="text" name="targetGroupEffectSuggestion" placeholder="the effect on the targeted group will be..."></td>
          </tr>
          <tr>
            <td class="cb-pink">Type of offensiveness&nbsp;</td>
            <td class="cb-pink">${offensiveness}</td>
            <td>
              <label><input class="likelihood" type="radio" for="offensivenessRating" name="offensivenessRating" value=3 required> Very likely</label><br>
              <label><input class="likelihood" type="radio" for="offensivenessRating" name="offensivenessRating" value=2> Somewhat likely</label><br>
              <label><input class="likelihood" type="radio" for="offensivenessRating" name="offensivenessRating" value=1> Somewhat unlikely</label><br>
              <label><input class="likelihood" type="radio" for="offensivenessRating" name="offensivenessRating" value=0> Very unlikely</label>
            </td>
            <td>Suggest a better offensiveness:<br>
            <input type="text" name="offensivenessSuggestion" placeholder="..."></td>
          </tr>
 
        </table>
        
        <div class="col-12 mt-5" id="demogQuestions" style="display: inline-block;">
          <h4 style="font-style: italic;">2. Please tell us about yourself <small>(this will remain confidential)</small></h4>How people perceive offensiveness/inequality is influenced by their own societal experience.
          <form style="margin-top: 20px;">
            <div class="form-group row">
              <h6 class="col-12">What is your gender?</h6><label for="gender" class="col-sm-2 col-form-label">Gender identity</label>
              <div class="col-sm-4">
                <!--input type="text" id="gender" name="annotatorGender" placeholder="" class="form-control"-->
                <select id="annotatorGender" name="annotatorGender" class="form-control" style="font-size: .85rem;" required="">
                  <option disabled selected value="">
                    -- please select --
                  </option>
                  <option value="man">
                    Man/Male
                  </option>
                  <option value="woman">
                    Woman/Female
                  </option>
                  <option value="nonBinary">
                    Non-binary
                  </option>
                  <option value="other">
                    Other
                  </option>
                  <option value="na">
                    Prefer not to disclose
                  </option>
                </select>
              </div>
              <div class="col-sm-5 alert alert-secondary prefilled-message" id="demog-prefilled-message" style="padding: 3px; margin-bottom:0; display: none;">
                To save you time, we've pre-filled these boxes based on your previous answers in our HITs! Feel free to change your answers if you want.
              </div>
            </div>
            <div class="form-group row">
              <h6 class="col-12">How old are you?</h6><label for="annotatorAge" class="col-sm-2 col-form-label">Age ranges</label>
              <div class="col-sm-4">
                <select id="annotatorAge" name="annotatorAge" class="form-control" style="font-size: .85rem;" required="">
                  <option disabled selected value="">-- please select --</option>
                  <option value="18">18-24</option>
                  <option value="25">25-29</option>
                  <option value="30">30-34</option>
                  <option value="35">35-39</option>                 
                  <option value="40">40-44</option>
                  <option value="45">45-49</option>
                  <option value="50">50-54</option>
                  <option value="55">55-59</option>
                  <option value="60">60-64</option>
                  <option value="65">65+</option>
                  <option value="na">-- prefer not to disclose --</option>
                </select>
              </div>
            </div>
            <div class="form-group row">
              <h6 class="col-12">What best describes your race/ethnicity?</h6><label for="race" class="col-sm-2 col-form-label">Race/ethnicity</label>
              <div class="col-sm-4">
                <select id="annotatorRace" name="annotatorRace" class="form-control" style="font-size: .85rem;" required="">
                  <option disabled selected value="">
                    -- please select --
                  </option>
                  <option value="asian">
                    Asian/Asian American
                  </option>
                  <option value="indian">
                    South Asian/Indian American
                  </option>
                  <option value="black">
                    Black/African American
                  </option>
                  <option value="hisp">
                    Hispanic/Latinx
                  </option>
                  <option value="white">
                    White/Caucasian
                  </option>
                  <option value="middleEastern">
                    Middle Eastern
                  </option>
                  <option value="islander">
                    Native Hawaiian/Pacific Islander
                  </option>
                  <option value="native">
                    Native American/First Nations
                  </option>
                  <option value="other">
                    Mixed/other
                  </option>
                  <option value="na">
                    Prefer not to disclose
                  </option>
                </select>
              </div>
              <div class="col-sm-3">
                <small>Please select the racial/ethnic identity you most identify with currently.</small>
              </div>
            </div>
            <div class="form-group row">
              <div class="col-12">
                <h6>What best describes your political orientation?</h6><!--input type="text" id="race" name="annotatorRace" placeholder="" class="form-control"-->
                <!--select id="annotatorPolitics" name="annotatorPolitics" class="form-control" style="font-size: .85rem;" required>
                        <option disabled selected value="">== please select ==</option>
                        <option value="cons">Conservative</option>
                        <option value="mod-cons">Moderate conservative</option>
                        <option value="mod-liberal">Moderate liberal</option>
                        <option value="liberal">Liberal/progressive</option>
                        <option value="libert">Libertarian</option>
                        <option value="other">Other/independent</option>
                        <option value="na">Prefer not to disclose</option>
                      </select-->
                <div class="form-check form-check-inline ml-3 lickert">
                  <label class="form-check-label" for="annotatorPolitics1">Strongly liberal &nbsp;</label> <input class="form-check-input right" type="radio" name="annotatorPolitics" id="annotatorPolitics1" value="1" required="">
                </div>
                <div class="form-check form-check-inline lickert">
                  <label class="form-check-label" for="annotatorPolitics2">&nbsp;</label> <input class="form-check-input right" type="radio" name="annotatorPolitics" id="annotatorPolitics2" value="2">
                </div>
                <div class="form-check form-check-inline lickert">
                  <label class="form-check-label" for="annotatorPolitics3">&nbsp;</label> <input class="form-check-input right" type="radio" name="annotatorPolitics" id="annotatorPolitics3" value="3">
                </div>
                <div class="form-check form-check-inline lickert">
                  <label class="form-check-label" for="annotatorPolitics4">&nbsp;</label> <input class="form-check-input right" type="radio" name="annotatorPolitics" id="annotatorPolitics4" value="4">
                </div>
                <div class="form-check form-check-inline lickert">
                  <label class="form-check-label" for="annotatorPolitics5">&nbsp;</label> <input class="form-check-input" type="radio" name="annotatorPolitics" id="annotatorPolitics5" value="5"> <label class="form-check-label" for="annotatorPolitics5">&nbsp; Strongly conservative</label>
                </div>
              </div>
            </div>
            <div class="form-group row">
              <h6>Any other minority identity?</h6><label for="annotatorMinority" class="col-sm-12 col-form-label">Do you identify with any minority, disadvantaged, demographic, or other specific groups? If so, which one(s)?<br>
              <small>(E.g., racial, gender identity, sexuality, disability, immigrant, veteran, etc.); use commas to separate groups.</small></label>
              <div class="col-sm-6">
                <input type="text" name="annotatorMinority" placeholder="" class="form-control" id="annotatorMinority" style="font-size: .85rem;">
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
      <div class="row justify-content-center">
        <div class="col-9" id="commentSection" style="display: inline-block;text-align: center;">
          <p style="font-size:10pt;margin-top: 50px;">
            Optional Feedback: Thanks for filling out the questions above!
            If something about the hit was unclear, please either leave a comment in the box below!
            We would like to make this HIT easier for future workers, so we really appreciate feedback though it is optional.
            <br>
            If you have concerns or questions, please email us!
          </p>
          <textarea style="margin-left:10px;margin-top:10px;width: 95%;" rows="2" name="commentbox"></textarea>
          <br><br>
          <center>
            <div class="alert alert-danger" id="submitAlert" style="display: none;">
              Whoops you missed some questions!
              <br>
              Note: if the submit button is disabled and you're confident this is an error, please screenshot your answers and the console output (Ctrl+Shift+J or Cmd+Shift+J).
            </div>
            <input type="submit" id="submitButton" class="btn btn-primary" value="Submit Hit!">       
          </center>
        </div>
      </div>
    </div>
  </fieldset>
</section>
<script>
  var targ, btngroup, event, selectedText, aspectDiv, workerInfo;
  var attentionChecks = ["first","second", "third", "fourth", "fifth"];
  
  $("label.btn-checkbox>input[type='checkbox']").each(function(ix,e){
    var value = $(e).parent().prop("innerText").trim();
    e.value = value == "" ? "_other_" : value;
  });

  $(".likelihood").on("click",function(e){ 
    event = e; 
    var dim = e.target.name.replace("Rating","")
    var val = parseInt($("input[name='"+dim+"Rating']:checked").prop("value"));
    console.log(dim,val);
    if (val < 2) 
      $("input[name='"+dim+"Suggestion']").prop("required","true");
    else 
      $("input[name='"+dim+"Suggestion']").prop("required","");
  })
  $(".btn-checkbox").on("click",function(e){
    targ = e.target;
    aspectDiv = $(targ).closest(".card-body").find(".aspects");

    /* Highlight button if checkbox is clicked */
    if(e.target.tagName == "INPUT"){
      if (targ.checked)
        $(targ).parent().addClass("active");
      else 
        $(targ).parent().removeClass("active");
    }
    
    /* Make textboxes required if any checkbox is checked */
    if ($(targ).closest(".btn-group-vertical").find("input:checkbox:checked").length > 0) {
      aspectDiv.show();
      aspectDiv.find("input[type='text']").each(function (i,e){
        if (i>1)
          return;
        $(e).prop("required","true");
      });
    } else {
      aspectDiv.hide();
      aspectDiv.find("input[type='text']").each(function (i,e){
        $(e).prop("value","");
        if (i>1)
          return;
        $(e).prop("required","");
      });
    }
    alertMinorityQs("yes");
  });
  $('.collapse-checkbox').on('hide.bs.collapse', function (e) {
  /* If any checkboxes are checked, this makes sure the buttons don't disappear */
  btngroup = e.target;
  if ($(btngroup).find("input:checkbox:checked").length > 0)
    e.preventDefault();
  })
  $(".othercheckbox").on("click",function(e){
    var checked = $(e.target).prop("checked")
    $(e.target).next().prop("disabled",!checked);
    $(e.target).next().prop("required",checked? "true": "");
  });
  $("input[type='text']").prop("pattern",".{0}|.{3,}").prop("title","Minimum 3 characters");

  
  $("button.btn-link").on("click",function(e){
    //Not sure why I need this, but otherwise accordion submits immediately
    e.preventDefault();
    event = e;
    //console.log(e.target);
  });
  $("#submitButton").on("click",function(e){
    var val = validate();
    if (!val) {
      e.preventDefault();
      event = e;
      $("#submitAlert").show();
      setTimeout(function(){
        $("#submitAlert").hide(300);
      }, 10000);
    } else {
      sendWorkerInfo();
      $("#clickedSubmitTime").val((new Date()).getTime());
      console.log("Submitted");
    }
  });
  function layout(){
    $("#postText").each(function (i,e){
      ee = e;
      e.innerText = renderEmoji(e.innerText);
    });
    var attnIx = Math.floor(Math.random()*attentionChecks.length);
    console.log("Attention check "+(attnIx+1)+" "+attentionChecks[attnIx])
    $("#attentionCheckInstr").text(attentionChecks[attnIx]);
    $("#attentionCheckCorrect").val(attnIx+1);
  }
  function getURLParams(){
    var search = location.search;
    if (location.hostname === "homes.cs.washington.edu"){
      search = "?workerId=A1TW2IIFTWJIB2&hitId=Testing";
      console.log(search)
    }
    
    search = search.substring(1);
    if (search == ""){
      console.log("No search params "+location.href);
      return {};
    }
    var params = JSON.parse('{"' + search.replace(/&/g, '","').replace(/=/g,'":"') + '"}', function(key, value) { return key===""?value:decodeURIComponent(value) });

    params["HITId"] = params["hitId"];
    params["HITType"] = "contextSBF-validation";
    console.log(params);
    return params;
  }
  function toggleConsent(checked){
    if (checked){
      $("#actualTask").show();
      $("#consentMessage").hide();
      $("#clickedConsentTime").val((new Date()).getTime());
    } else {
      $("#actualTask").hide();
      $("#consentMessage").show();
    }
  }
  function toggleDontUnderstandAck(checked){
    if(checked)
      $("#dontUnderstandAck").show()
    else
      $("#dontUnderstandAck").hide()
  }
  function prepSQLparamsCheck(urlParams){
    var out="";
    out += "tableName="+"workerDemographics";
    out += "&workerId="+urlParams["workerId"];
    out += "&HITType="+urlParams["HITType"];
    out += "&assignmentId="+urlParams["assignmentId"];
    out += "&HITId="+urlParams["HITId"];
    return out;
  }
  function prepSQLparamsStore(){
    var out="";
    out += "tableName="+"workerDemographics";
    out += "&gender="+$("#annotatorGender").val();
    out += "&age="+$("#annotatorAge").val();
    out += "&race="+$("#annotatorRace").val();
    out += "&politics="+$('input[name="annotatorPolitics"]:checked').val();
    out += "&otherMinority="+encodeURIComponent($("#annotatorMinority").val());

    
    return out;
  }
  function dealWithWorkerInfo(sqlResponse){
    if (sqlResponse == ""){
      /* we don't have this worker in our DB*/
      console.log("New worker!");
      $(".prefilled-message").hide();
      if (location.hostname == "homes.cs.washington.edu"){
        $("#consent").prop("checked",true);
        toggleConsent(true);
      }
    } else {
      workerInfo = JSON.parse(sqlResponse);
      console.log(workerInfo);
      // Bypass consent? Only on UW servers
      if (location.hostname == "homes.cs.washington.edu"){
        $("#consent").prop("checked",true);
        toggleConsent(true);
      }
      $(".prefilled-message").show();
      $("#annotatorGender").val(workerInfo["gender"]);
      $("#annotatorAge").val(workerInfo["age"]);
      $("#annotatorRace").val(workerInfo["race"]);
      //$("#annotatorPolitics").val(workerInfo["politics"]);
      $('#annotatorPolitics'+workerInfo["politics"]).prop("checked",true)
      $("#annotatorMinority").val(workerInfo["otherMinority"]);
    
    }
  }
  function checkIfWorkerExists(){
    var urlParams = getURLParams();
    var requestParams = "?"+prepSQLparamsCheck(urlParams)+"&action=check";//location.search+"&action=check";
    var requestURL = "https://homes.cs.washington.edu/~msap/debug/neural-detox/checkStoreWorkerDemographicsMore.php";
    var xhttp = new XMLHttpRequest();
    console.log(requestURL+requestParams);
    xhttp.open("POST", requestURL+requestParams, true);
    xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        //var responseRaw = this.responseText;
        dealWithWorkerInfo(this.responseText);
        //console.log("Received an answer!"+this.responseText);
      }
    };
    xhttp.send(requestParams);
  }
  function sendWorkerInfo(){
    var urlParams = getURLParams();
    var requestParams = "?"+prepSQLparamsCheck(urlParams)+"&action=store&"+prepSQLparamsStore();
    var requestURL = "https://homes.cs.washington.edu/~msap/debug/neural-detox/checkStoreWorkerDemographicsMore.php";
    var xhttp = new XMLHttpRequest();
    console.log(requestURL+requestParams);
    xhttp.open("POST", requestURL+requestParams, true);
    xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        //var responseRaw = this.responseText;
        //dealWithWorkerInfo(this.responseText);
        console.log("Received an answer: '"+this.responseText+"'");
      }
    };
    xhttp.send(requestParams);
  }
  function validate(){
  
    valid = $("input:invalid").length == 0;
    console.log("########## VALIDATING #########\nvalid? "+valid);
    $("input:invalid").each(function (i,e){
      console.log(e);
    });
    return valid;
  }
  function alertMinorityQs(val){
    if (val == "yes" && $(".btn-checkbox>input:checked").length == 0) {
      //$("#dummyMinority").prop("required","true");
      $("#alertQminority").show();
    } else {
      //$("#dummyMinority").prop("required","");
      $("#alertQminority").hide();
    }
  }
  var rows;
  function expExamples(){
    rows = $("tr.extra-rows");
    $("a:contains('examples')").each(function(ix,link){
      if (rows.hasClass("show"))
        link.innerText = "[+] more examples";
      else 
        link.innerText = "[-] less examples";
      console.log(link);
    })
  }

</script>
<style type="text/css">

#examples-table {
  border-style: solid solid solid solid;
  border-width: 1px;
  border-color: #dee2e6;
  border-radius: 5px;
  padding: 2px;
}
#examples-table td {
  border: #dee2e6;
  border-style: solid;
  border-width: 1px;
  padding: 2px;
}

#inputTable {
  border:1px solid #b3adad;
  border-collapse:collapse;
  padding:5px;
}
#inputTable td {
  border:1px solid #b3adad;
  padding:5px;
}

.card-header-accordion{
  padding: 0px 10px;
}
body, td, .btn { 
  font-size:0.85rem;
}
label {
  margin-bottom: 0px;
}
.story-excerpt {
  margin: 40px auto;
  min-width: 500px;
  border:2px #333333;
  background-color: #f2f2f2;
  border-style: solid;
  padding-right:10px;
  padding-left:10px;
  display:table;
  border-radius:15px;
}
.story-excerpt-example {
  border: 1px solid #666666;
  background-color: #f2f2f2;
  border-radius: 3px;
  padding: 3px;
  display: inline-block;
  margin: 10px;
}
span.numbering {
  font-weight: bold;
  margin-right: .5em;
}
#introQuestion>div>label>input,
#intentQuestion>div>label>input {
  vertical-align: middle;
}
.prefilled-message{
  font-style: italic;
}

#detailed-instructions>p {
  margin-bottom: 0px;
}
span.instrQuestion {
  background-color: #f2f2f2;
  font-style: italic;
  font-size: .9rem;
  margin: 5px 0 3px -15px;
  padding: 0 .3rem 0 .3rem;
  display: inline-block;
}
span.instrDescription {
  font-size: .9rem;
  margin-left: -15px;
}
label > input[type='text'] {
  width: 90%;
}
input[type='text'] {
  width: 300px;
}
input[type='text'].opt-target {
  background-color: #f8f8f8;
}

input[type="text"]:invalid {
  color: #a94442;
  background-color: #f2dede;
}

textarea#postText {
  margin-left: 20px;
  font-size: 12pt;
  width: auto;
  background-color: transparent;
  overflow: auto;
  resize: none;
}

.btn-checkbox, .btn-checkbox-two {
  .btn-light;
  color: black;
  text-align: left;
  margin: 0px;
  background-color: #e9ecef;
  border-color: #d1d4d7;
}

.btn-checkbox.active,
.btn-checkbox:active,
.btn-checkbox:hover {
  background-color: #babcbf;
  border-color: #8b8d8f;
}

.btn-checkbox-two.active,
.btn-checkbox-two:active,
.btn-checkbox-two:hover {
  background-color: #babcbf;
  border-color: #8b8d8f;
}

.btn-group-vertical {
  max-width: 400px;
  /*margin-right: 10px;*/
}
#introQuestion, 
#minorityQuestions,
#demogQuestions {
  margin-bottom: 10px;
  margin-top: 10px;
}
.autocomplete-suggestions { 
  border: 1px solid #999;
  background: #FFF; 
  overflow: auto;
}
#dummyMinority {
  /*opacity:0;*/
  width: 0px;
}
.autocomplete-suggestion { padding: 2px 5px; white-space: nowrap; overflow: hidden; }
.autocomplete-selected { background: #F0F0F0; }
.autocomplete-suggestions strong { font-weight: normal; color: #3399FF; }
.autocomplete-group { padding: 2px 5px; }
.autocomplete-group strong { display: block; border-bottom: 1px solid #000; }

input[type='checkbox'] {
  /* All <input> elements that are immediate children of a class="btn-checkbox" */
  margin-right: 5px;
}
ul {
  padding-left: 30px;
  margin-bottom: 10px;
}
fieldset {
  padding: 10px;
  background:#fbfbfb;
  border-radius:5px; 
  margin-bottom:5px;
}
.lickert>label{
    font-style: italic;
  }
  
.cb-teal {
  color: #1b9e77
}
.cb-orange {
  color: #d95f02
}
.cb-purple {
  color: #7570b3
}
.cb-pink {
  color: #e7298a
}
.cb-green {
  color: #66a61e
}
.cb-gold {
  color: #e6ab02 
}
.cb-brown{
  color: #a6761d
}
.cb-bg-teal {
  background-color: #1b9e77
}
.cb-bg-orange {
  background-color: #d95f02
}
.cb-bg-purple {
  background-color: #7570b3
}
.cb-bg-pink {
  background-color: #e7298a
}
.cb-bg-green {
  background-color: #66a61e
}
.cb-bg-gold {
  background-color: #e6ab02 
}
.cb-bg-brown{
  background-color: #a6761d
}
todo {
  font-style: italic;
  font-weight: bold;
  color: #e60000;
  background-color: black;
}

xuhui {
  color: #66a61e;
  font-style: italic;
}

.possibleAnswer {
  margin-left: 2em;
}


/*********************************/
.imessage {
  background-color: #fff;
  border: 1px solid #e5e5ea;
  border-radius: 0.25rem;
  display: flex;
  flex-direction: column;
  font-family: "SanFrancisco";
  font-size: 1.25rem;
  margin: 0 auto 1rem;
  max-width: 600px;
  padding: 0.5rem 1.5rem;
}

.imessage p {
  border-radius: 1.15rem;
  line-height: 1.25;
  max-width: 75%;
  padding: 0.5rem .875rem;
  position: relative;
  word-wrap: break-word;
}

.imessage p::before,
.imessage p::after {
  bottom: -0.1rem;
  content: "";
  height: 1rem;
  position: absolute;
}

p.from-me {
  align-self: flex-end;
  background-color: #248bf5;
  color: #fff; 
}

p.from-me::before {
  border-bottom-left-radius: 0.8rem 0.7rem;
  border-right: 1rem solid #248bf5;
  right: -0.35rem;
  transform: translate(0, -0.1rem);
}

p.from-me::after {
  background-color: #fff;
  border-bottom-left-radius: 0.5rem;
  right: -40px;
  transform:translate(-30px, -2px);
  width: 10px;
}

p[class^="from-"] {
  margin: 0.5rem 0;
  width: fit-content;
}

p.from-me ~ p.from-me {
  margin: 0.25rem 0 0;
}

p.from-me ~ p.from-me:not(:last-child) {
  margin: 0.25rem 0 0;
}

p.from-me ~ p.from-me:last-child {
  margin-bottom: 0.5rem;
}

p.from-them {
  align-items: flex-start;
  background-color: #e5e5ea;
  color: #000;
}

p.from-them:before {
  border-bottom-right-radius: 0.8rem 0.7rem;
  border-left: 1rem solid #e5e5ea;
  left: -0.35rem;
  transform: translate(0, -0.1rem);
}

p.from-them::after {
  background-color: #fff;
  border-bottom-right-radius: 0.5rem;
  left: 20px;
  transform: translate(-30px, -2px);
  width: 10px;
}

p[class^="from-"].emoji {
  background: none;
  font-size: 2.5rem;
}

p[class^="from-"].emoji::before {
  content: none;
}

.no-tail::before {
  display: none;
}

.margin-b_none {
  margin-bottom: 0 !important;
}

.margin-b_one {
  margin-bottom: 1rem !important;
}

.margin-t_one {
  margin-top: 1rem !important;
}


</style>